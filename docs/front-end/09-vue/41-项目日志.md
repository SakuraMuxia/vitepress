# 项目日志

## 启动项目DEMO

* 将项目目录中的sph放置本地

* 进入到目录sph,安装依赖模块

  ```shell
  cnpm i
  ```

* package.json

  ```json
  {
  	"scripts":{
  		"start":"node server.js"
  	},
  	
    "dependencies": {
      "connect-history-api-fallback": "^2.0.0",
      "express": "^4.18.2",
      "http-proxy-middleware": "^2.0.6"
    }
  }
  ```

* 启动：

  ```shell
  npm start
  ```

## 通过脚手架搭建项目

* 选择默认版本vue2

  ```shell
  vue create first # 选择默认安装 vue2 -->Default ([Vue 2] babel, eslint) 
  ```

## 整理项目

* 复制尚品汇图标至public->favicon.ico

* 启动项目如果站标未发生改变，清除缓存，然后重新打开浏览器。

* public->index.html

  ```html
  <!DOCTYPE html>
  <html lang="">
  <head>
  	<meta charset="utf-8">
  	<link rel="icon" href="<%= BASE_URL %>favicon.ico">
  	<title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
  	<div id="app"></div>
  </body>
  </html>
  ```

* vue.config.js

  ```js
  const {defineConfig} = require('@vue/cli-service')
  module.exports = defineConfig({
  	transpileDependencies: true,
  	// publicPath:"./",// 更改BASE_URL
  	devServer:{
  		open:true,
  		host:"zhangpeiyue.com",
  		port:80
  	},
  	pages: {
  		index: {
  			// page 的入口
  			entry: 'src/index.js',
  			// 设置网站标题
  			title:"尚品汇"
  		}
  	}
  })
  ```

  官方文档：https://cli.vuejs.org/zh/config/#pages

  ```javascript
  module.exports = {
    pages: {
      index: {
        // page 的入口
        entry: 'src/index/main.js',
        // 模板来源
        template: 'public/index.html',
        // 在 dist/index.html 的输出
        filename: 'index.html',
        // 当使用 title 选项时，
        // template 中的 title 标签需要是 <title><%= htmlWebpackPlugin.options.title %></title>
        title: 'Index Page',
        // 在这个页面中包含的块，默认情况下会包含
        // 提取出来的通用 chunk 和 vendor chunk。
        chunks: ['chunk-vendors', 'chunk-common', 'index']
      },
      // 当使用只有入口的字符串格式时，
      // 模板会被推导为 `public/subpage.html`
      // 并且如果找不到的话，就回退到 `public/index.html`。
      // 输出文件名会被推导为 `subpage.html`。
      subpage: 'src/subpage/main.js'
    }
  }
  ```

## 解决esling问题

* src->index.js

  ```js
  import Vue from "vue";
  import App from "@/App";
  const vm = new Vue({
  	el:"#app",
  	render:h=>h(App)
  })
  ```

* 解决一,配置忽略：package.json

  ```json
  {
    ....
      "rules": {
      	// 不用的变量忽略检查
          "no-unused-vars":0,
      	// 组件命名多个字母
          "vue/multi-word-component-names": 0
      }
    .....
  }
  ```

* 解决二：整体忽略lint检查 vue.config.js

  ```js
  const {defineConfig} = require('@vue/cli-service')
  module.exports = defineConfig({
  	transpileDependencies: true,
  	// 忽略lint检查
  	lintOnSave:false,
  	// publicPath:"./",// 更改BASE_URL
  	devServer:{
  		open:true,
  		host:"zhangpeiyue.com",
  		port:80
  	},
  	pages: {
  		index: {
  			// page 的入口
  			entry: 'src/index.js',
  			// 设置网站标题
  			title:"尚品汇"
  		}
  	}
  })
  ```

* 解决三：在esling配置文件中更改 .eslintrc.js

  ```javascript
  module.exports = {
      root: true,
      env: {
          node: true
      },
      'extends': [
          'plugin:vue/essential',
          'eslint:recommended'
      ],
      parserOptions: {
          parser: '@babel/eslint-parser'
      },
      rules: {
          'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
          'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
          "vue/multi-word-component-names": "off",
          "vue/valid-v-slot":"off",
      }
  }
  ```

  

## 将首页放置到App.vue组件中

* swiper.min.css放到public->css->swiper.min.css

* 在public->index.html中引入css

  ```html
  <!DOCTYPE html>
  <html lang="">
  <head>
  	<meta charset="utf-8">
  	<link rel="icon" href="<%= BASE_URL %>favicon.ico">
  	<link rel="stylesheet" href="<%= BASE_URL >css/swiper.min.css">
  	<title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
  	<div id="app"></div>
  </body>
  </html>
  
  ```

* 把home的css放在src->pages->Home->index.vue中的style标签中

  ```vue
  ...
  ```

* 把重置样式表reset.css放在index.js文件中导入

  ```js
  import "src/assets/css/reset.css"
  ```

* 安装less

  ```javascript
  npm install less-loader less -D // -D 在开发环境中使用
  ```

* 把图片放置在 src->assets->images中

* 修改html中的img的src地址为正确的地址

## 头部与底部组件

* src->components->Header->index.vue

  ```javascript
  把头部组件Header.vue从APP.vue中抽离出来，
  同时把组件内的图片单独放置在组件中的文件夹 src->components->Header->images
  ```

* src->components->Footer->index.vue

  ```javascript
  把尾部组件Footer.vue从APP.vue中抽离出来
  同时把组件内的图片单独放置在组件中的文件夹 src->components->Footer->images
  ```

* src->App.vue

  ```javascript
  ...
  ```

## 创建基本的路由

```javascript
首页：------>   /
登陆: --------> /login
注册:---------->/register
搜索:------------>/search
```

* 安装vue-router

  ```javascript
  cnpm install vue-router@3 // vue-router 3版本对vue2支持
  ```

* 在src目录下创建4个页面 src->pages->Home,src->pages->login,src->pages->register,src->pages->search

* src->router->index.js

  ```javascript
  import Vue from "vue";
  import VueRouter from "vue-router";
  import Home from "@/pages/Home";
  import Login from "@/pages/Login";
  import Register from "@/pages/Register";
  import Search from "@/pages/Search";
  Vue.use(VueRouter);
  const routes = [
  	{
  		path:"/",
  		component:Home
  	},
  	{
  		path:"/login",
  		component:Login
  	},
  	{
  		path:"/Register",
  		component:Register
  	},
  	{
  		path:"/search",
  		component:Search
  	}
  ];
  const router = new VueRouter({
  	mode:"history",
  	routes
  });
  export default router;
  ```

* 把首页Home.vue从App.vue中抽离出来

  ```javascript
  html中的图片的src修改图片为 ../../assets/images/home/
  
  ```

  

* src->App.vue

  ```vue
  <template>
      <!-- 项目的最外层 -->
      <div>
          <!--  头部 -->
          <Header></Header>
          <router-view/>
          <!--  底部  -->
          <Footer></Footer>
      </div>
  </template>
  
  <script>
  import Home from "@/pages/Home";
  import Header from "@/components/Header";
  import Footer from "@/components/Footer";
  export default {
      name: "App",
      components: {Footer, Header, Home}
  }
  </script>
  
  <style lang="less" scoped>
  </style>
  ```

* src->index.js

  ```javascript
  import Vue from "vue";
  import App from "@/App";
  import router from "@/router";
  import "@/assets/css/reset.css";
  new Vue({
  	el:"#app",
  	router,
  	render:h=>h(App)
  })
  ```


## 实现导航切换

* src->components->Header->index.vue

  ```javascript
  <!--1-->
  <router-link to="/login">登录</router-link>
  <!--2-->
  <router-link to="/register" class="register">免费注册</router-link>
  <!--3-->
  <router-link to="/" class="logo" title="尚品汇"> <img src="./images/logo.png" alt="">
  </router-link>
  <!--4-->
  <button @click="$router.push('/search')" class="sui-btn btn-xlarge btn-danger" type="button">搜索</button>
  ```

* src->App.vue

  ```javascript
  <!-- 匹配的路由出口 -->
  <router-view></router-view>
  ```

## Push方法重写

* src->router->index.js(方式1)

  ```javascript
  // 1- 先将要加强的方法备份
  const nativePush = VueRouter.prototype.push;
  const nativeReplace = VueRouter.prototype.replace;
  // 2- 重写方法，在重写的方法中调用备份方法
  VueRouter.prototype.push = function(location, onComplete, onAbort){
  	return nativePush.call(this,location, onComplete, ()=>{})
  }
  VueRouter.prototype.replace = function(location, onComplete, onAbort){
  	return nativeReplace.call(this,location, onComplete, ()=>{})
  }
  // replace
  ```

* src->router->index.js(方式2)

  ```javascript
  新建一个文件夹 utils/tools 用于存放自定义的工具 
  mkdir src->utils->pushReWrite.js
  
  ```

## 设置分类条组件

方式1：把typeNav设置为全局组件

```json
// 1 src->components->TypeNav->index.vue
....从Home.vue中抽离出来

// 2 src->index.js
// 导入全局组件
import TypeNav from "@/components/TypeNav";
Vue.component("TypeNav", TypeNav);
...

// 3 src->pages->Home->index.vue
<TypeNav></TypeNav>
```

方式2：将typeNav放在Header中，由路由控制显示和隐藏

```javascript
// 1 src->components->Header->TypeNav->index.vue
....把typeNav放在Header组件中

// 2 src->components->Header->index.vue
<template>
	<!-- 商品分类栏 -->
	<TypeNav v-if="$route.meta.isTypeNav"></TypeNav>     
</template>
import TypeNav from "@/components/Header/TypeNav";
components: { TypeNav },
```

## 使用axios获取分类条数据

* 在  src->components->TypeNav->index.vue 组件中使用axios获取数据

```javascript
npm install axios

// src->components->TypeNav->index.vue

<script>
export default {
    name: "TypeNav",
    
}
</script>
```

* vue.config.js 配置代理服务器，注意重启服务

```javascript
const {defineConfig} = require('@vue/cli-service')
module.exports = defineConfig({
	transpileDependencies: true,
	// 忽略lint检查
	lintOnSave:false,
	devServer:{
		open:true,
		host:"zhangpeiyue.com",
		port:80,
        // 1
		proxy:{
            // 访问"/api"的路径，统一拼接为"http://sph-h5-api.atguigu.cn/api"
			"/api":{
				target:"http://sph-h5-api.atguigu.cn",
				changeOrigin:true
			}
		}
	},
	pages: {
		index: {
			// page 的入口
			entry: 'src/index.js',
			// 设置网站标题
			title:"尚品汇"
		}
	}
})
```

## 使用 nprogress 插件

使用 nprogress 插件，渲染axios加载进度条

* 下载nprogress https://www.npmjs.com/package/nprogress

  ```javascript
  npm install nprogress
  ```

* src->components->Header->TypeNav->index.vue

  ```javascript
  <script>
  import axios from "axios";
  import nprogress from "nprogress";
  import "nprogress/nprogress.css"
  
  export default {
      name: "TypeNav",
      mounted() {
          // 请求地址：http://sph-h5-api.atguigu.cn/api/product/getBaseCategoryList
          // 请求方式:get
          nprogress.start();// 开始加载
          axios.get("/api/product/getBaseCategoryList")
          .then(({data}) => {
              console.log(data);
              // 加载完成
              nprogress.done();
          },err=>{
              console.log(err);
              nprogress.done;
          })
      },
  }
  </script>
  ```

* nprogress的使用

  ```javascript
  Add nprogress.js and nprogress.css to your project
  //添加nprogress.js and nprogress.css
  import nprogress from "nprogress"; // 在node_modules/nprogress/component.json中的main中指定了入口文件为nprogress.js
  import "nprogress/nprogress.css"
  // 使用
  NProgress.start(); //加载
  NProgress.done();	// 加载完成
  ```

## axios封装

* 新建一个sphRequest.js文件(发送axios请求)，src->request->sphRequest.js

```javascript
import axios from "axios";
import nprogress from "nprogress";
import "nprogress/nprogress.css";
// 创建一个实例
const sphRequest = axios.create({
    baseURL: "/api",
    timeout: 5000
});
// 请求拦截器
sphRequest.interceptors.request.use(config => {
    nprogress.start();// 开启进度条
    return config;
});
// 响应拦截器
sphRequest.interceptors.response.use(response => {
    nprogress.done();// 结束进度条
    return response.data;// 返回响应体
},err=>{
    nprogress.done();// 结束进度条
    alert(err);//提示错误信息
    return new Promise(() => { });//中断Promise
})
// 暴漏数据
export default sphRequest;
```

* 新建一个入口文件，src->request->index.js

```javascript
// 引入请求
import sphRequest from "@/request/sphRequest";
// 暴漏数据
export {
    sphRequest
}
```

* 在组件中使用 src->components->Header->TypeNav->index.vue

```javascript
<script>
import {sphRequest} from "@/request"
export default {
    name: "TypeNav",
    mounted() {
        sphRequest.get("/product/getBaseCategoryList")
        .then(res=>{
            console.log("res",res);
        })
    },
}
</script>
```

## API封装

建议：按照后端提供的API进行分类

```javascript
新建一个api文件夹，src->api->product.js
```

```javascript
// 导入axios
import { sphRequest } from "@/request";
// 暴漏数据
export const getBaseCategoryList = function(){
    return sphRequest("/product/getBaseCategoryList");
}
```

