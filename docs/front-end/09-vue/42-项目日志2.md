## 全局过滤器

1. 创建filter文件夹：src->filters->index.js

```js
// 定义一个过滤器
const filters = {
    // 时间过滤器
    date(t){
        const timer = new Date(t);
        return timer.getFullYear() + "-" +
            (timer.getMonth() + 1).toString().padStart(2, 0) + "-" +
            timer.getDate().toString().padStart(2, 0) + " " +
            timer.getHours().toString().padStart(2, 0) + ":" +
            timer.getMinutes().toString().padStart(2, 0) + ":" +
            timer.getSeconds().toString().padStart(2, 0);
    },
    // 金额过滤器
    currency(v, n = 2, type = "$") {
        return type + v.toFixed(n);
    }
}
// 暴漏一个函数
export default function(V){
    for(let key in filters){
        V.filter(key,filters[key]);
    }
}
```

2. 在入口文件引入 src->main.js

```js
// 导入filters
import filters from "@/filters"

Vue.config.productionTip = false
Vue.use(filters);
```

3. 应用过滤器 src->pages->Home->RankList->index.vue

```vue
<template lang="">
    <div>
        ...
         <div class="tab-info">
             <div class="info-title">
                <a href="#">{{item.name}}</a>
    		</div>
            <p class="info-price">定金:{{info.price|currency(2,"￥")}}</p>
    	</div>
        ...
    </div>
</template>
<script>
export default {
    
}
</script>
<style lang="">
    
</style>
```

## node实现后端

1. 安装express，编辑server.js

```js
npm install express
```

```js
const express = require("express");
const likeData = require("./data/likeList.json");
const app = express();
// 请求方式：get
// 请求地址：http://zhangpeiyue.com:8082/likeList
// 请求参数：query
//     pageSize：每页显示的条数
//     pageNo:页码
// 响应结果：
// {
//      ok:1,
//      msg:"success",
//      likeList:[],// 喜欢列表
//      pageSum:1// 总页数
// }
app.get("/likeList",(req,res)=>{
	/*
	* 1- 接收参数
	* 2- 根据参数获取数据
	* 3- 响应数据*/
	let {pageSize=6,pageNo=1} = req.query;
	pageNo = pageNo/1;
	pageSize = pageSize/1;
	// pageNo===>1
	res.json({
		ok:1,
		msg:"success",
		likeList:likeData.slice((pageNo-1)*pageSize,pageSize*pageNo),
		pageSum:Math.ceil(likeData.length/pageSize)
		// 1
		// likeList:likeData.slice(0,6)
		// likeList:likeData.slice(6,12)
	})
})
app.listen(9090,()=>{
	console.log("success");
})
```

2. 配置data数据：api->data->likeList.json

```json
[
    {
        "id": 1,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 2,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 3,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 4,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 5,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 6,
        "title": "大希地牛排 母后恩点儿童牛排 整切牛排 果蔬腌制宝宝",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/192352/27/35184/246085/64b8f357Fba2db77b/18c1c62aa5a6ff1d.jpg",
        "price": 89
    },
    {
        "id": 7,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    },
    {
        "id": 8,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    },
    {
        "id": 9,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    },
    {
        "id": 10,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    },
    {
        "id": 11,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    },
    {
        "id": 12,
        "title": "食者道鸡排 鸡胸肉鸡扒 低脂高蛋白 奥尔良黑椒孜然3",
        "imgUrl": "https://img10.360buyimg.com/n3/jfs/t1/91472/39/33627/443660/64bf3963F60ccd12b/42cb86098908ec3c.jpg",
        "price": 98
    }
]
```

3. 启动node

```js
node start server.js
// 测试访问
http://127.0.0.1:9090/likeList?pageNo=1&pageSize=5
```



## 猜你喜欢

1. 配置代理，解决跨域问题。src->vue.config.js

```js
proxy: {
            // 请求地址：http://sph-h5-api.atguigu.cn/api/product/getBaseCategoryList
            // 访问"/api"的路径，统一拼接为"http://sph-h5-api.atguigu.cn/api"
            "/api": {
                target: "http://sph-h5-api.atguigu.cn",
                changeOrigin: true
            },
            // 访问"/hanser"的路径，统一拼接为"http://127.0.0.1:9090/hanser"
            "/hanser":{
                target: "http://127.0.0.1:9090",
                changeOrigin:true,
                pathRewrite:{
                    // http://127.0.0.1:9090 == http://127.0.0.1:9090/hanser
                    "^/hanser":""
                }
            }
        }
```

2. 封装request，nodeRequest。src->request->nodeRequest.js

```js
import axios from "axios";
import nprogress from "nprogress";
import "nprogress/nprogress.css";

// 创建一个实例
const nodeRequest = axios.create({
    baseURL: "/hanser",
    timeout: 5000
});
// 请求拦截器
nodeRequest.interceptors.request.use(config => {
    nprogress.start();// 开启进度条
    return config;
});
// 响应拦截器
nodeRequest.interceptors.response.use(response => {
    nprogress.done();// 结束进度条
    return response.data;// 返回响应体
}, err => {
    nprogress.done();// 结束进度条
    alert(err);//提示错误信息
    return new Promise(() => { });//中断Promise
})
// 暴漏数据
export default nodeRequest;
```

3. 封装api getLikeList接口 src->api->product.js

```js
import { sphRequest, mockRequest ,nodeRequest} from "@/request";
...
// 获取猜你喜欢数据
const getLikeList = ()=>{
    return nodeRequest("/hanser/likeList")
}
...
```

4. 创建store likeList数据仓库 src->store->product->index.js

```js
// 定义商品的数据状态
const state = {
    // 首页分类列表
    categoryList:[],
    // 楼层数据状态
    floorList:[],
    // rank的数据仓库
    rankList:[],
    // 猜你喜欢
    likeList:[]
}
// 定义mutations
const mutations = {
    // 修改state中的首页分类列表
    UP_CATEGORY_LIST(state,categoryList){
        state.categoryList = categoryList
    },
    // 修改state中的楼层列表
    SAVE_FLOOR_LIST(state, floorList) {
        state.floorList = floorList;
    },
    // 修改rank中的数据
    SAVE_RANK_LIST(state, rankList) {
        state.rankList = rankList;
    },
    // 修改like中的数据
    SAVE_LIKE_LIST(state, likeList) {
        state.likeList = likeList;
    },
    // 修改pageSum的数据
    SAVE_SUM(state, pageSum){
        state.pageSum = pageSum;
    }
}
// 定义actions
const actions = {
    // 使用api接口获取数据
    async getBaseCategoryListAsync({commit},num=1){
        const { data } = await getBaseCategoryList();
        commit("UP_CATEGORY_LIST",data.splice(0,num));
    },
    // FloorList获取数据
    async getFloorListAsync({ commit }) {
        const { data } = await getFloorList();
        commit("SAVE_FLOOR_LIST", data);
    },
    // 使用api获取rankList说几句
    async getRankListAsync({ commit }) {
        const { data } = await getRankList();
        commit("SAVE_RANK_LIST", data);
    },
    // 使用api获取likeList说几句
    async getLikeListAsync({ commit },pageNo,pageSize=6) {
        try {
            const { data , pageSum} = await getLikeList(pageNo,pageSize);
            commit("SAVE_LIKE_LIST", data);
            commit("SAVE_SUM", pageSum);
        } catch (error) {
            console.error("Failed to fetch like list:", error);
        }
    }
}
```

5. 抽离出猜你喜欢 组件 src->pages->Home->like->index.vue

```vue
<template lang="">
    <div class="like">
        <div class="py-container">
            <div class="title">
                <h3 class="fl">猜你喜欢</h3>
                <a href="javascript:;" @click="changeLike" class="fr tip changeBnt">换一换</a>
            </div>
            <div class="bd">
                <ul class="favourate">
                    <li v-for="(item,index) in likeList" :key="index">
                        <img :src="item.imgUrl" alt="" />
                        <div class="like-text">
                            <p>{{item.title}}</p>
                            <h3>{{item.price | currency(2,"￥")}}</h3>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</template>
<script>
import {mapState,mapActions} from "vuex";
export default {
    name:"Like",
    computed:{
        ...mapState("product", ["likeList","pageSum"])
    },
    data(){
        return{
            pageSize:3,
            pageNo:1,
        }
    },
    mounted(){
        this.getLikeListAsync(this.pageNo,this.pageSize);
    },
    methods: {
        ...mapActions("product", ["getLikeListAsync"]),
        // changeLike方法
        changeLike(){
            this.pageNo++;
            if (this.pageNo > this.pageSum){
                this.pageNo = 1;
            }
            this.getLikeListAsync(this.pageNo, this.pageSize);
        }
    },
}
</script>
```



## 获取分类名称和ID

1. 根据后端接口信息获取分类名称和ID

```js
// categoryName:分类的名称
// category1Id:一级分类ID
// category2Id:二级分类ID
// category3Id:三级分类ID
```

2. 修改导航组件 src->components->Header->TypeNav->index.vue

```vue
通过在标签上设置自定义属性 data-level 保存并记录 点击的元素是 哪个分类级别
<template>
<div @click="goSearch" class="all-sort-list2">
    <div v-for="c1 in categoryList" :key="c1.categoryId" class="item">
        <h3>
            <a data-level="1" > {{ c1.categoryName }}</a>
        </h3>
        <div class="item-list clearfix">
            <div v-for="c2 in c1.categoryChild" :key="c2.categoryId" class="subitem">
                <dl class="fore">
                    <dt>
                        <a data-level="2" href="">{{ c2.categoryName }}</a>
                    </dt>
                    <dd>
                        <em v-for="c3 in c2.categoryChild" :key="c3.categoryId">
                            <a data-level="3" href="">{{ c3.categoryName }}</a>
                        </em>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>
</template>
<script>
export default {
    // 点击分类跳转
    goSearch(e){
        const {id,level} = e.target.dataset;
        // 如果id存在，点击后路由到/search并且拼接查询字符串
        if(id){
            this.$router.push({
                path:"/search",
                query:{
                    // category2Id:12
                    ["category"+level+"Id"]:id,
                    categoryName:e.target.innerText.trim()
                }
            })
            // 点击后 分类页隐藏
            this.isShowCategory = false;
        }
    },
}
</script>
```

3. Search页面接收参数：src->pages->Search->index.vue

```vue
<template>
    <div>
        <h3>搜索界面,接收的参数：{{$route.query}}</h3>
    </div>
</template>
<script>
export default {
    name: "Search",
}
</script>
<style lang="less" scoped>
h3 {
    padding: 50px;
    background: yellow;
}
</style>
```



## 获取搜索框中内容

1. 在Header组件中修改：src->components->Header->index.vue

```js
<template lang="">
    <div>
		...
		<div class="searchArea">
            <form action="###" class="searchForm">
                <input placeholder="请输词" ref="keyword" type="text"class="input-error "/>
                <button @click="goSearch" class="sui-btn" type="button">搜索</button>
             </form>
         </div>	
		...
    </div>
</template>
<script>
export default {
    methods: {
        // 搜索跳转方法
        goSearch() {
            const keyword = this.$refs.keyword.value.trim();
            // 判断关键字是否有值，
            if(keyword){
                this.$router.push({
                    path:"/search",
                    query:{
                        keyword,
                    }
                })
            }
        }
    },
    mounted(){
        // 判断查询字符串中是否有keyword,如果有将其值设置为搜索框的内容。
        if (this.$route.query.keyword)
            this.$refs.keyword.value = this.$route.query.keyword;
    }
}
</script>
<style lang="less">
    
</style>
```

## 合并类别和关键词搜索

```js

```

## 调用接口获取数据

```js

```

## 渲染搜索数据

```js

```

## SearchSeletor渲染

```js

```

## 面包屑导航

```js

```

## 事件总线清空搜索栏

```js

```

## 按照品牌进行搜索

```js

```

## 无搜索条件隐藏面包屑导航

```js

```

