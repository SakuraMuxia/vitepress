# 项目日志3

## 购买数量加减操作

1. 在Details页面中修改：src->pages->Details->index.vue

```vue
<template lang="">
    <div>
		<div class="cartWrap">
            <!-- 购物车数量的添加 -->
            <div class="controls">
                <!-- 方式1：使用方法控制数量 -->
                <input @change="upBuyNumByAntiShake" autocomplete="off" class="itxt" :value="buyNum">
                <!-- 通过类名来判断是否是假发还是减法 -->
                <a href="###" class="['plus',{disabled:buyNum===200}]" @click.prevent="changeBuyNum">+</a>
                <a href="###" class="['mins',{disabled:buyNum===1}]" @click.prevent="changeBuyNum">-</a>
            </div>
            <div class="add">
                <a href="###" target="_blank">加入购物车</a>
            </div>
        </div>
    </div>
</template>
<script>
...
import { goodsNumReg } from "@/utils/reg";
export default {
    name:"Details",
    data(){
        return{
            // 购买的数量
            buyNum:1
        }
    },
    methods:{
        // 更新购买的数量
        upBuyNum(e){
            // 获取e的值
            const num = e.target.value.trim()/1;
            // 如果输入的数值在正则表达式的范围内，则更新数据，否则使用旧的值
            if (goodsNumReg.test(num)){
                this.buyNum = num;
            }else{
                e.target.value = this.buyNum
            }
        },
        // 加减法函数
        changeBuyNum(e){
            // 减法
            if(e.target.classList.contains("mins")){
                if(this.buyNum===1) return;
                this.buyNum--;
            } else if (e.target.classList.contains("plus")) {
                if (this.buyNum===200) return;
                this.buyNum++;
            }
        }
    },
}
</script>
<style lang="">
    
</style>
```

2. 导入正则表达式来限制输入的数值范围在1-200之间：src->utils->reg.js

```js
//校验商品购买数量的正则表达式
export const goodsNumReg = /^([1-9]|[1-9]\d|1\d{2}|200)$/
//手机号正则
export const phoneReg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/
//验证码正则
export const codeReg = /^\d{6}$/
//密码正则
export const pwdReg = /^\w{6,21}$/
```

3. 应用正则表达式：src->pages->Details->index.vue

```js
import {goodsNumReg} from "@/utils/reg";
```

## 实现防抖

1. 在Details页面中修改：src->pages->Details->index.vue

```vue
<template lang="">
    <div>
        <div class="cartWrap">
            <!-- 购物车数量的添加 -->
            <div class="controls">
                <!-- 方式1：使用方法upBuyNum控制数量 -->
                <!-- 方式2：使用防抖upBuyNumByAntiShake控制数量 -->
                <!-- 方式3：使用方法upBuyNumByLodash控制数量 -->
                <input @change="upBuyNumByLodash" autocomplete="off" class="itxt" :value="buyNum">
                <!-- 通过类名来判断是否是假发还是减法 -->
                <a href="###" class="['plus',{disabled:buyNum===200}]" @click.prevent="changeBuyNum">+</a>
                <a href="###" class="['mins',{disabled:buyNum===1}]" @click.prevent="changeBuyNum">-</a>
            </div>
            <div class="add">
                <a href="###" target="_blank">加入购物车</a>
            </div>
        </div>
    </div>
</template>
<script>
export default {
    ...
    methods:{
        // 更新购买的数量
        upBuyNum(e){
            // 获取e的值
            const num = e.target.value.trim()/1;
            // 如果输入的数值在正则表达式的范围内，则更新数据，否则使用旧的值
            if (goodsNumReg.test(num)){
                this.buyNum = num;
            }else{
                e.target.value = this.buyNum
            }
        },
        // 更新购买的数量（原生防抖）防抖是多次触发执行最后一个，节流是多次触发执行第一个
        upBuyNumByAntiShake(e){
            // 如果有定时器，先清除以前定时器
            if (this.timer){
                clearTimeout(this.timer);
            }
            // 声明一个单次定时器,1秒延迟后执行回调函数
            this.timer = setTimeout(()=>{
                // 获取input输入框的数值
                const num = e.target.value.trim() / 1;
                if (goodsNumReg.test(num)) {
                    this.buyNum = num;
                } else {
                    e.target.value = this.buyNum;
                }
            },1000)
        },
        // 使用第三方lodash实现防抖
        upBuyNumByLodash(){

        },
        // 加减法函数
        changeBuyNum(e){
            // 减法
            if(e.target.classList.contains("mins")){
                if(this.buyNum ===1 ) return;
                this.buyNum--;
            } else if (e.target.classList.contains("plus")) {
                if (this.buyNum === 200) return;
                this.buyNum++;
            }
        }
    },
}
</script>

```

2. 使用第三方实现防抖 lodash

```js
npm install lodash
import {debounce} from "lodash"

src->pages->Details->index.vue
// 使用
    methods:{
        // 更新购买的数量
        upBuyNum(e){
            // 获取e的值
            const num = e.target.value.trim()/1;
            // 如果输入的数值在正则表达式的范围内，则更新数据，否则使用旧的值
            if (goodsNumReg.test(num)){
                this.buyNum = num;
            }else{
                e.target.value = this.buyNum
            }
        },
        // 更新购买的数量（原生防抖）防抖是多次触发执行最后一个，节流是多次触发执行第一个
        upBuyNumByAntiShake(e){
            // 如果有定时器，先清除以前定时器
            if (this.timer){
                clearTimeout(this.timer);
            }
            // 声明一个单次定时器,1秒延迟后执行回调函数
            this.timer = setTimeout(()=>{
                // 获取input输入框的数值
                const num = e.target.value.trim() / 1;
                if (goodsNumReg.test(num)) {
                    this.buyNum = num;
                } else {
                    e.target.value = this.buyNum;
                }
            },1000)
        },
        // 使用第三方lodash实现防抖
        upBuyNumByLodash: debounce(function (e) {
            const num = e.target.value.trim() / 1;
            if (goodsNumReg.test(num)) {
                this.buyNum = num;
            } else {
                e.target.value = this.buyNum;
            }
        },1000),
        // 加减法函数
        changeBuyNum(e){
            // 减法
            if(e.target.classList.contains("mins")){
                if(this.buyNum ===1 ) return;
                this.buyNum--;
            } else if (e.target.classList.contains("plus")) {
                if (this.buyNum === 200) return;
                this.buyNum++;
            }
        }
    },
```



## lodash

防抖的原理：

```js
封装防抖函数
思路：

声明一个定时器变量
当鼠标每次滑动都判断是否有定时器，如果有定时器，先清除以前定时器
如果没有定时器，则开一个定时器
在定时器里面调用要执行的函数

const box = document.querySelector('.box')
let i = 1

function mouseMove() {
    box.innerHTML = i++
}

function debounce(fn, t) {
    // 1.声明一个定时器变量
    let timer
    return function () {
        // 2.如果有定时器，先清除定时器
        if (timer) clearTimeout(timer)
        // 3.4.重新设置定时函数
        timer = setTimeout(fn, t)
    }
}

box.addEventListener('mousemove', debounce(mouseMove, 200))
```

防抖和节流的区别：

```vue
防抖是多次触发执行最后一个，节流是多次触发执行第一个

防抖 => 回城
节流 => 技能冷却
```

使用lodash实现防抖：

```js
下载：cnpm install lodash
引入：import {debounce} from "lodash"
使用：_.debounce(要执行的函数, 延后执行的时间)
<!-- 在使用时我已经将lodash的js文件下载到了本地 -->
<script src="../lodash.min.js"></script>
<script>
    const box = document.querySelector('.box')
	let i = 1
    function mouseMove() {
        box.innerHTML = i++
    }
	box.addEventListener('mousemove', _.debounce(mouseMove, 200))
</script>

```

节流的原理：

```js
封装节流函数思路：

声明一个定时器变量
当鼠标每次滑动都判断是否有定时器，如果有定时器已经开启，则不做操作
如果没有定时器，则开一个定时器
定时器到达时间，清空定时器

const box = document.querySelector('.box')
    let i = 1

    function mouseMove() {
      box.innerHTML = i++
    }

    function debounce(fn, t) {
      // 1.声明一个空定时器变量
      let timer = null
      return function () {
        // 2.如果没有定时器，可以设置定时器
        if (!timer) {
          timer = setTimeout(function () {
            fn()
            // 4.冷却完，清空定时器
            timer = null
          }, t)
        }
        // 3.如果已经有定时器，不做操作
      }
    }
    box.addEventListener('mousemove', debounce(mouseMove, 3000))
```

使用lodash实现节流：

```js
<!-- 在使用时我已经将lodash的js文件下载到了本地 -->
<script src="../lodash.min.js"></script>
<script>
    const box = document.querySelector('.box')
    let i = 1
    function mouseMove() {
        box.innerHTML = i++
    }
    box.addEventListener('mousemove', _.throttle(mouseMove, 3000))
</script>
```

lodash实现防抖：src->pages->Details->index.vue

```vue
https://www.lodashjs.com/docs/lodash.debounce#_debouncefunc-wait0-options
```

## 加入购物车成功界面

1. 搭建加入购物车的路由：src->pages->AddCartSuccess->index.vue

```vue
<template lang="">
    <div>
        <!-- 商品完成添加到购物车 -->
        <div class="cart-complete-wrap">
            <div class="cart-complete">
                <h3>
                    <i class="iconfont icon-success"></i>商品已成功加入购物车！
                </h3>
                <div class="goods">
                    <div class="left-good">
                        <div class="left-pic"><img src="../../assets/images/gocart.jpg"></div>
                        <div class="right-info">
                            <p class="title">美的（Midea)电饭煲WFZ5099IH IH电磁加热 1250W大火力 钛金釜5L电饭锅</p>
                            <p class="attr">颜色：WFZ5099IH/5L钛金釜内胆 数量：1</p>
                        </div>
                    </div>
                    <div class="right-gocart">
                        <a href="#" class="sui-btn btn-xlarge">查看商品详情</a>
                        <a href="cart.html" class="sui-btn btn-xlarge btn-danger " target="_blank">去购物车结算 &gt; </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
export default {
    name: "AddCartSuccess"
}
</script>
<style lang="less" scoped>
    ...
</style>
```

2. 添加加入购物车的路由：src->router->index.js

```js
import AddCartSuccess from '@/pages/AddCartSuccess';
...
    // 加入购物车的路由
    {
        path: "/addCartSuccess",
        component: AddCartSuccess,
    }
...
```

3. 修改商品页跳转到加入购物车：src->pages->Details->index.vue

```vue
<template lang="">
	...
	<div class="add">
        <a @click.prevent="addCart"  href="###" target="_blank">加入购物车</a>
    </div>
	...
</template>
<script>
methods: {
    // 加入购物车
    addCart(){
        this.$router.push("/addCartSuccess");
    }
}
</script>
```

## 切换商品配置

1. 在数据仓库添加 mutations 用于更新商品的配置 src->store->product->index.js

```js
// 商品信息
productInfo:{
    // 商品详情
    skuInfo: {
        // 定义缩略图列表，防止出现undefined 报错
        skuImageList: [],
            // 定义商品属性列表，防止出现undefined 
            spuSaleAttrList:[],
    }
}
// 修改productInfo中的配置信息,参数是 商品的颜色ID和版本ID
UP_ATTR_LIST_BY_ID(state,{a1Id,a2Id}){
    // 找到一级信息
    const info1 = state.productInfo.spuSaleAttrList.find(v => v.id === a1Id);
    console.log(info1);
},
```



## 完成购物车界面功能

```vue

```

