# Vue3路由使用案例

1. 添加首页的Message组件：src->pages->Home->Message->index.vue

```vue

```

2. 添加首页的NewList组件：src->pages->Home->NewsList->index.vue

```vue

```

3. 添加首页页面：src->pages->Home->index.vue

```vue

```

4. 路由入口文件添加路由：src->router->index.ts

```js
{
    path: "/home",
    component: Home,
        children:[
            {
                path:"/home",
                redirect:"/home/newsList"
            },
            {
                path:"/home/message",
                component:()=>import("@/pages/Home/Message/index.vue")
            },
            {
                path:"/home/newsList",
                component:()=>import("@/pages/Home/NewsList/index.vue")
            }
        ]
}
```

5. 渲染Message组件：src->pages->Home->Message->index.vue

```js
cnpm install axios
```

```vue
<template>
    <div>
        <div>
            <ul>
                <li v-for="item in state.films" :key="item.filmId">
                    <a href="/home/message/1">{{item.name}}</a> &nbsp;&nbsp;
                    <button>push</button> &nbsp;
                    <button>replace</button>
                </li>
            </ul>
            <button>前进</button>
            <button>后退</button>
        </div>
    </div>
</template>

<script lang="ts" setup>
import {onMounted, reactive} from "vue";
import axios from "axios";
let state = reactive({
    films:[]
})
onMounted(function(){
    // https://m.maizuo.com/gateway?cityId=310100&pageNum=1&pageSize=10&type=1&k=6086743
    axios.get('https://m.maizuo.com/gateway?cityId=310100&pageNum=1&pageSize=3&type=1&k=6086743',{
        headers:{
            "X-Client-Info":'{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
            "X-Host":"mall.film-ticket.film.list"
        }
    }).then(value=>{
        // console.log(value.data.data.films);
        state.films = value.data.data.films;
    })

})
</script>

<style scoped>

</style>
```

6. 创建Message组件下的Details组件：src->pages->Home->Message->Detail->index.vue

```vue
<template>
    <h3>Detail</h3>
</template>

<script lang="ts" setup>

</script>

<style scoped>

</style>
```

7. 创建三级路由：src->router->index.ts

```js
{
            path:"/home/message",
            component:()=>import("@/pages/Home/Message/index.vue"),
            children:[
                {
                    path:"/home/message/:filmId",
                    component:()=>import("@/pages/Home/Message/Detail/index.vue")
                }
            ]
		}
```

8. 优化路由：src->router->index.ts

```js
import NotFount from "@/pages/NotFount/index.vue";
// 1- 引入createRouter
import {createRouter, createWebHashHistory, createWebHistory} from "vue-router"
// 2- 配置每一个路由器的信息
const renderCom = function(name:string){
    return ()=>import("@/pages/"+name+"/index.vue");
}
const routes = [
    {
        path: "/",
        redirect: "/home"
    }, {
        path: "/home",
        component: renderCom("Home"),
        children:[
            {
                path:"/home",
                component:renderCom("Home/NewsList")
            },
            {
                path:"/home/message",
                component:renderCom("Home/Message"),
                children:[
                    {
                        path:"/home/message/:filmId",
                        component:renderCom("Home/Message/Detail")
                    }
                ]
            }
        ]
    },
    {
        path: "/about",
        component:renderCom("About")
    },
    {
        // vue-router@4不支持以下代码实现404
        // path:"*",
        // component:NotFount

        // 需要借助params形式实结合正则实现404
        path: "/:pathMath(.*)",
        component:renderCom("NotFount")
    }
]
// 3- 创建router
const router = createRouter({
    // 相当于Vue2当中的mode:"history"
    history: createWebHistory(),
    // 相当于Vue2当中的mode:"hash"
    // history:createWebHashHistory(),
    routes,
    // linkExactActiveClass:"active",
    // linkActiveClass:"active",
    scrollBehavior() {
        return {
            left: 0,// 相当于之前的x
            top: 0// 相当于之前的y
        }
    }
});

// console.log("router",router);
export default router;
```

## 数据渲染

1. 渲染Message组件中的数据：src->pages->Home->Message->index.vue

```vue
<template>
    <ul>
        <li v-for="item in state.films" :key="item.filmId">
            <router-link :to="{
                path:'/home/message/'+item.filmId
            }">{{item.name}}</router-link> &nbsp;&nbsp;
            <button>push</button> &nbsp;
            <button>replace</button>
        </li>
    </ul>
    <button>前进</button>
    <button>后退</button>
    <hr/>
    <router-view></router-view>
</template>
```

2. 渲染Details组件中的数据：src->pages->Home->Message->Detail->index.vue

```vue
<template>
    <h3>{{state.film.name}}</h3>
    <p>{{state.film.synopsis}}</p>
</template>

<script lang="ts" setup>
// 1- 在模板中可以直接使用$route
// 2- 在script标签中无法使用$route，如何解决？
// 方案一
// import $router from "@/router";
// console.log($router.currentRoute.value.params.filmId);

// 方案二
// import {useRouter} from "vue-router";
// import router from "@/router"
// const $router = useRouter();
// console.log($router===router);// true
// console.log($router.currentRoute.value.params.filmId)

// 方案三
// import {useRoute} from "vue-router";
// const $route = useRoute();
// console.log($route.params.filmId)

import {onMounted, reactive, watch} from "vue";
import {onBeforeRouteUpdate, useRoute} from "vue-router";
import axios from "axios";
const $route = useRoute();
const state = reactive({
    film:{}
})
// 获取数据方案一
// const getway = async function(filmId:string){
//     const {data:{data:{film}}} =await axios.get("https://m.maizuo.com/gateway?filmId="+filmId+"&k=7345366",{
//         headers:{
//             "X-Client-Info":'{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
//             "X-Host":"mall.film-ticket.film.info"
//         }
//     })
//     state.film = film;
// }
// onBeforeRouteUpdate(async function(to,from,next){
//     await getway(to.params.filmId as string)
//     next();
// })
// onMounted(function(){
//     getway($route.params.filmId as string)
// })

// 获取数据方案二- watch
watch(()=>$route.params.filmId,async (filmId)=>{
    const {data:{data:{film}}} =await axios.get("https://m.maizuo.com/gateway?filmId="+filmId+"&k=7345366",{
        headers:{
            "X-Client-Info":'{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
            "X-Host":"mall.film-ticket.film.info"
        }
    })
    state.film = film;
},{
    immediate:true
})
</script>

<style scoped>

</style>
 
```

## 编程式导航

1. src->pages->Home->Message->index.vue

```vue

```

