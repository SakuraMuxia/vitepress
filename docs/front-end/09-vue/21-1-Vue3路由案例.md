# Vue3二级路由案例

## Vue3中使用bootstrap@3

1. 安装Jquery

```js
npm install jquery --save
```

2. 配置Jquery：vue.config.js文件配置

```js
const { defineConfig } = require('@vue/cli-service')
module.exports = defineConfig({
    transpileDependencies: true,
    devServer: {
        open: true,// 自动打开浏览器
        port: 8080,// 指定端口号
        host: "127.0.0.1",// 指定host
    },
    // 关闭编译时的特征标志
    chainWebpack: (config) => {
        config.plugin('define').tap((definitions) => {
            Object.assign(definitions[0], {
                __VUE_OPTIONS_API__: 'true',
                __VUE_PROD_DEVTOOLS__: 'false',
                __VUE_PROD_HYDRATION_MISMATCH_DETAILS__: 'false'
            })
            return definitions
        })
    }
})
const webpack = require("webpack")
module.exports = defineConfig({
    transpileDependencies: true,
    configureWebpack: {
        plugins: [
            new webpack.ProvidePlugin({
                $: "jquery",
                jQuery: "jquery",
                "windows.jQuery": "jquery",
                "windows.$": "jquery",
                Popper: ["popper.js", "default"]
            })
        ]
    }
})
```

3. 安装bootstrap：

```js
npm install bootstrap@3
```

4. 在入口文件引入：main.ts

```js
import '../node_modules/bootstrap/dist/css/bootstrap.min.css'
import "../node_modules/bootstrap/dist/js/bootstrap.min.js"
```

问题：

```js
这个引入就跟上面的vue2全局引入一样了
如果运行报如下错误，可以在项目根目录下新建一个.eslintignore文件
文件中只写一个 *
```

5. 也可以按照html静态页面link引入：public->index.html

```html
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <link rel="stylesheet" href="/bootstrap.css">
    <title><%= htmlWebpackPlugin.options.title %></title>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
```

## 创建静态组件

1. 创建入口文件：src->main.ts

```tsx
import { createApp } from 'vue'
import App from './App.vue'

import '../node_modules/bootstrap/dist/css/bootstrap.min.css'
import "../node_modules/bootstrap/dist/js/bootstrap.min.js"

import router from "@/router/"

createApp(App).use(router).mount('#app')
```

2. 配置vue：vue.config.js

```js
const { defineConfig } = require('@vue/cli-service')
const webpack = require("webpack")
module.exports = defineConfig({
    transpileDependencies: true,
    devServer: {
        open: true,// 自动打开浏览器
        port: 8080,// 指定端口号
        host: "127.0.0.1",// 指定host
    },
    // 关闭编译时的特征标志
    chainWebpack: (config) => {
        config.plugin('define').tap((definitions) => {
            Object.assign(definitions[0], {
                __VUE_OPTIONS_API__: 'true',
                __VUE_PROD_DEVTOOLS__: 'false',
                __VUE_PROD_HYDRATION_MISMATCH_DETAILS__: 'false'
            })
            return definitions
        })
    },
    // 配置Jquery
    configureWebpack: {
        plugins: [
            new webpack.ProvidePlugin({
                $: "jquery",
                jQuery: "jquery",
                "windows.jQuery": "jquery",
                "windows.$": "jquery",
                Popper: ["popper.js", "default"]
            })
        ]
    },
})
```

3. 主组件：src->App.vue

```vue
<template>
    <div class="row">
        <div class="col-xs-offset-2 col-xs-8">
            <div class="page-header">
                <h2>Vue3 Router Demo</h2>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-2 col-xs-offset-2">
            <div class="list-group">
                <router-link class="list-group-item" active-class="active" to="/about">About</router-link>
                <router-link class="list-group-item" active-class="active" to="/home">Home</router-link>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="panel">
                <div class="panel-body">
                    <router-view></router-view>
                </div>
            </div>
        </div>
    </div>
</template>

<script lang="ts" setup>

</script>

<style scoped></style>
```

4. 首页：src->pages->Home->index.vue

```vue
<template>
    <h2>Home组件内容</h2>
    <div>
        <ul class="nav nav-tabs">
            <li><router-link to="/home/newsList" exact-active-class="active" class="list-group-item">NewsList</router-link></li>
            <li><router-link to="/home/message" active-class="active" class="list-group-item">Message</router-link></li>
        </ul>
        <div>
            <router-view></router-view>
        </div>
    </div>
</template>

<script lang="ts" setup>

</script>

<style scoped></style>
```

5. 二级页面NewsList：src->pages->Home->NewsList->index.vue

```vue
<template>
    <h4>NewsList组件内容</h4>
    <ul>
        <li>
            <a href="/home/message/1">news001</a> &nbsp;&nbsp;
            <button>push</button> &nbsp;
            <button>replace</button>
        </li>
        <li><a href="/home/message/2">news002</a> &nbsp;&nbsp;<button>push
            </button> &nbsp;<button>
                replace
            </button>
        </li>
        <li><a href="/home/message/3">news003</a> &nbsp;&nbsp;<button>push
            </button> &nbsp;<button>
                replace
            </button>
        </li>
    </ul>
    <button>前进</button>
    <button>后退</button>
</template>

<script lang="ts" setup>

</script>

<style scoped></style>
```

6. 二级页面Message：src->pages->Home->Message->index.vue

```vue
<template>
    <h4>Message组件内容</h4>
    <div>
        <ul>
            <li v-for="item in state.films" :key="item.filmId">
                <router-link to="{
                    path:''
                }">{{item.name}}</router-link> &nbsp;&nbsp;
                <button>push</button> &nbsp;
                <button>replace</button>
            </li>
        </ul>
        <button>前进</button>
        <button>后退</button>
    </div>
</template>

<script lang="js" setup>
import { onMounted,reactive } from 'vue'
import {getMessage} from '@/api/index'

let state = reactive({
    films: []
})

onMounted(function(){
    getMessage().then(res => {
        state.films = res.data.films
    })
})


</script>

<style scoped></style>
```

7. 三级页面Details：src->pages->Home->Message->Details->index.vue

```vue
<template>
    <h4>Detail</h4>
</template>

<script lang="ts" setup>

</script>

<style scoped></style>
```

8. 路由配置文件：src->router->index.ts

```tsx
import { createRouter, createWebHashHistory, createWebHistory } from "vue-router"
// 生成路由组件的方法
const renderCom = function (name: string) {
    return () => import("@/pages/" + name + "/index.vue");
}

const routes = [
    {
        path: "/",
        redirect: "/home"
    }, 
    {
        path: "/home",
        component: () => import('@/pages/Home/index.vue'),
        children:[
            {
                path:'/home',
                redirect:'/home/newslist'
            },
            {
                path: "/home/message",
                // 路由懒加载
                component: () => import("@/pages/Home/Message/index.vue"),
                children: [
                    {
                        path: "/home/message/:filmId",
                        component: renderCom("Home/Message/Details/index.vue")
                    }
                ]
            },
            {
                path: "/home/newsList",
                component: () => import("@/pages/Home/NewsList/index.vue")
            },
        ]
    },
    {
        path: "/about",
        component: () => import('@/pages/About/index.vue')
    },
    {
        // vue-router@4不支持以下代码实现404
        // path:"*",
        // component:NotFount

        // 需要借助params形式实结合正则实现404
        path: "/:pathMath(.*)",
        component: () => import('@/pages/NotFount/index.vue')
    }
]
// 3- 创建router
const router = createRouter({
    // 相当于Vue2当中的mode:"history"
    history: createWebHistory(),
    // 相当于Vue2当中的mode:"hash"
    // history:createWebHashHistory(),
    routes,
    scrollBehavior() {
        return {
            left: 0,// 相当于之前的x
            top: 0// 相当于之前的y
        }
    }
    // 
})
export default router
```

9. 封装request：src->request->mz.js

```js
import axios from 'axios'
import nprogress from 'nprogress'
import 'nprogress/nprogress.css'
const mz = axios.create({
    baseURL: "https://m.maizuo.com/",
    timeout: 10000,
    headers: {
        "X-Client-Info": '{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
        "X-Host": "mall.film-ticket.film.list"
    }
});

mz.interceptors.request.use(config => {
    nprogress.start()
    return config;
})

// 设置响应拦截器
mz.interceptors.response.use(res => {
    nprogress.done()
    return res.data;
})

export default mz
```

10. 封装api：src->api->index.js

```js

```



## 数据渲染

1. 渲染Message组件中的数据：src->pages->Home->Message->index.vue

```vue
<template>
    <ul>
        <li v-for="item in state.films" :key="item.filmId">
            <router-link :to="{
                path:'/home/message/'+item.filmId
            }">{{item.name}}</router-link> &nbsp;&nbsp;
            <button>push</button> &nbsp;
            <button>replace</button>
        </li>
    </ul>
    <button>前进</button>
    <button>后退</button>
    <hr/>
    <router-view></router-view>
</template>
```

2. 渲染Details组件中的数据：src->pages->Home->Message->Detail->index.vue

```vue
<template>
    <h3>{{state.film.name}}</h3>
    <p>{{state.film.synopsis}}</p>
</template>

<script lang="ts" setup>
// 1- 在模板中可以直接使用$route
// 2- 在script标签中无法使用$route，如何解决？
// 方案一
// import $router from "@/router";
// console.log($router.currentRoute.value.params.filmId);

// 方案二
// import {useRouter} from "vue-router";
// import router from "@/router"
// const $router = useRouter();
// console.log($router===router);// true
// console.log($router.currentRoute.value.params.filmId)

// 方案三
// import {useRoute} from "vue-router";
// const $route = useRoute();
// console.log($route.params.filmId)

import {onMounted, reactive, watch} from "vue";
import {onBeforeRouteUpdate, useRoute} from "vue-router";
import axios from "axios";
const $route = useRoute();
const state = reactive({
    film:{}
})
// 获取数据方案一
// const getway = async function(filmId:string){
//     const {data:{data:{film}}} =await axios.get("https://m.maizuo.com/gateway?filmId="+filmId+"&k=7345366",{
//         headers:{
//             "X-Client-Info":'{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
//             "X-Host":"mall.film-ticket.film.info"
//         }
//     })
//     state.film = film;
// }
// onBeforeRouteUpdate(async function(to,from,next){
//     await getway(to.params.filmId as string)
//     next();
// })
// onMounted(function(){
//     getway($route.params.filmId as string)
// })

// 获取数据方案二- watch
watch(()=>$route.params.filmId,async (filmId)=>{
    const {data:{data:{film}}} =await axios.get("https://m.maizuo.com/gateway?filmId="+filmId+"&k=7345366",{
        headers:{
            "X-Client-Info":'{"a":"3000","ch":"1002","v":"5.2.1","e":"16923264631851757969801217","bc":"310100"}',
            "X-Host":"mall.film-ticket.film.info"
        }
    })
    state.film = film;
},{
    immediate:true
})
</script>

<style scoped>

</style>
 
```

## 编程式导航

1. src->pages->Home->Message->index.vue

```vue

```

