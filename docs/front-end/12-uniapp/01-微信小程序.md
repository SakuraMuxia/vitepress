# 微信小程序

项目的体积不能超过2M

```
2015年html5发布
2017年微信小程序第一次上线
```

## 背景移动端

### 移动端发展

```ts
2015年html5发布前，移动端开发
	安卓开发
    iOS开发
2015年html5发布后
	支持移动端开发：安卓和iOS开发都可以使用
    支持pc开发：网站
```

### 视口适配

```ts
眼睛可以看到内容的界面就是视口：展示内容区域

pc端的视口：当前浏览器的大小
pc端的视口：布局视口

问题：网页塞到手机里,手机视口看不全网页
解决：
	厂商统一一个标准：
		手机视口：布局视口(固定页面宽度 980px)
问题：存在缩放问题,字体偏小
解决：
	苹果公司：
    	手机视口：开启理想视口(页面和设备一样宽)
问题：网页的宽度不固定(在不同的设备上显示不一样，引发不适配问题)
解决：
	1 通过rem度量单位适配
    2 等比例放大，等比例缩小:等比例更改根元素的字体大小
    	通过计算等比例 计算出不同设备上的根元素的字体大小(750px 50px 是产品经理给的原型图的大小)
        // 当前设备宽度				   750px	375px
									
		// HTML根节点的font-size		50px	  ?
        function setRem(){
            // 获取视口根节点
            const html = document.documentElement;
            // 设置根节点字体大小
            html.style.fontSize = (document.documentElement.clientWidth *50)/750 + 'px'
        }
		// 浏览器视口适配
		window.onresize = setRem
		
```

### rem单位

```ts
# css3中新增的单位

# rem 根元素(html标签)字体大小的倍数 多用于移动端的使用

# 根元素(html标签)字体大小一般设置 整数
```

```html
<body>
	<div>123</div>    
</body>
<style>
    html{
        font-size:100px
    }
    body{
        font-size:16px
    }
    div{
        width:2rem,
        heigh:2rem,
    }    
</styles>
```

**小程序存储上限**

```ts
小程序存储上限为10M,浏览器的存储上限是5M
```

## 基础入门

### 微信小程序文档

```ts
APPID ： 开发-开发管理
文档：
https://developers.weixin.qq.com/miniprogram/dev/reference/
https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/sitemap.html
框架：配置文件的配置项解释
组件：组件
API：系统的API接口(分享，摄像头)
```



### 项目结构

```ts
pages:					放置的微信小程序应用的页面
sitemap.json:			配置文件,用户是否可以在微信内搜索小程序配置
project.config.json:	项目的配置文件

// app相关的都是小程序应用文件
app.js:					App函数,用于创建微信小程序应用app,App是内置的函数
app.json:				微信小程序应用app配置文件:小程序应用导航栏、页面路由的位置
app.wxss:				书写全局样式的地方[应用当中全部页面都可以使用样式]
```

> 一个应用app有多个页面page
>
> page在pages文件夹中
>
> 一个页面page由四个文件组成：wxml(静态结构) wxss(样式) js(逻辑) json(配置文件)

#### 全局配置

app.json 微信小程序应用app全局配置文件 

```ts
{
    
    "window": {
        "navigationBarBackgroundColor": "#3cc", // 导航的背景颜色 只能设置16进制
        "navigationBarTextStyle": "white", // 设置小程序的导航颜色
        "navigationBarTitleText": "慕尚花坊"// 设置小程序的导航标题
    },
    // 配置路由的时候最前边没有 '/' 标记
    "pages": [ // 配置路由,默认谁在最前边显示哪一个页面
        "pages/home/home",
        "pages/category/category",
        "pages/shopcart/shopcart",
        "pages/my/my",
        "pages/login/login",
        "pages/edit/edit",
        "pages/goods/goods",
        "pages/order/order",
        "pages/order/paySuccess/paysuccess",
        "pages/address/address",
        "pages/address/add/add"
    ],
}

```

**tabbar**

```ts
如果小程序是一个多 tab 应用（客户端窗口的底部或顶部有 tab 栏可以切换页面），可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页面
```

| 属性            | 类型     | 必填 | 默认值 | 描述                                                         |
| :-------------- | :------- | :--- | :----- | :----------------------------------------------------------- |
| color           | HexColor | 是   |        | tab 上的文字默认颜色，仅支持十六进制颜色                     |
| selectedColor   | HexColor | 是   |        | tab 上的文字选中时的颜色，仅支持十六进制颜色                 |
| backgroundColor | HexColor | 是   |        | tab 的背景色，仅支持十六进制颜色                             |
| borderStyle     | string   | 否   | black  | tabbar 上边框的颜色， 仅支持 `black` / `white`               |
| list            | Array    | 是   |        | tab 的列表，详见 `list` 属性说明，最少 2 个、最多 5 个 tab   |
| position        | string   | 否   | bottom | tabBar 的位置，仅支持 `bottom` / `top`                       |
| custom          | boolean  | 否   | false  | 自定义 tabBar，见[详情](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/custom-tabbar.html) |

其中 list 接受一个数组，**只能配置最少 2 个、最多 5 个 tab**。tab 按数组的顺序排序，每个项都是一个对象，其属性值如下

| 属性             | 类型   | 必填 | 说明                                                         |
| :--------------- | :----- | :--- | :----------------------------------------------------------- |
| pagePath         | string | 是   | 页面路径，必须在 pages 中先定义                              |
| text             | string | 是   | tab 上按钮文字                                               |
| iconPath         | string | 否   | 图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片。 **当 `position` 为 `top` 时，不显示 icon。** |
| selectedIconPath | string | 否   | 选中时的图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片。 **当 `position` 为 `top` 时，不显示 icon。** |

app.wxss：书写全局样式的地方

```ts
page{
    width: 100%;
    height: 100%;
}
```

app.js：全局js入口文件

```ts
//通过App内置函数:创建微信小程序应用
App({

    /**
     * 当小程序初始化完成时，会触发 onLaunch（全局只触发一次）
     */
    onLaunch: function () {

    },

    /**
     * 当小程序启动，或从后台进入前台显示，会触发 onShow
     */
    onShow: function (options) {

    },

    /**
     * 当小程序从前台进入后台，会触发 onHide
     */
    onHide: function () {

    },

    /**
     * 当小程序发生脚本错误，或者 api 调用失败时，会触发 onError 并带上错误信息
     */
    onError: function (msg) {

    }
})
```



### 页面结构

```ts
一个页面page由四个文件组成：wxml(静态结构) wxss(样式) js(逻辑) json(配置文件)
```

#### 新建页面步骤

```ts
新建一个文件夹,然后鼠标右击,再新建一个Page页面
```

#### wxml文件

用于组成当前页面的静态页面 类似于Vue中 `template`

```ts
view组件 替代 div标签

button组件 替代 button按钮 类似于 element-plus中的button组件

text组件 替代 span标签

image组件 替代 img标签   

input组件 替代 input标签 类似于 element-plus中的input组件
```

```xml
<view>{{text}}</view>
<view>{{array[0].msg}}</view>
```



#### wxss文件

用于控制当前页面的样式 类似于Vue中 `style`

```ts
# 微信小程序中的样式 通过 类名的 形式控制,不要使用标签
```

#### js文件

用于控制当前页面的逻辑判断 类似于Vue中 `script`

```ts
Page({ // 注册一个页面
    data: {
        msg:1
        text: 'init data',
        array: [{msg: '1'}, {msg: '2'}]
    }
    handle(){
        // 这种不是响应式数据,需要使用 setData函数设置 数据状态才是响应式
        console.log(this.data.msg += 1) // this 指向当前页面的配置对象(Page函数体内部对象)
        const newMsg = this.data.msg + 1;
        // 设置响应式数据
        this.setData({
            msg:newMsg
        })
	}
})
```

#### 页面配置

json文件

用于控制当前页面的配置 

`页面的配置文件优先级大于全局的配置文件设置`

```ts
"navigationBarBackgroundColor":"#ccc" // 设置当前页面的导航栏背景颜色
"navigationBarTextStyle": "black", // 设置当前页面的导航栏文字颜色
"navigationBarTitleText":"微信小程序"
```

### 视口自适应

```ts
使用 rpx 作为计量单位 相当于JS中的rem(同时还需要设置事件 onresize)

以iPhone6为例 200rpx 相当于 100px

建议： 开发微信小程序时设计师可以用 iPhone6 作为视觉稿的标准

rpx（responsive pixel）: 可以根据屏幕宽度进行自适应。规定屏幕宽为750rpx。如在 iPhone6 上，屏幕宽度为375px，共有750个物理像素，则750rpx = 375px = 750物理像素，1rpx = 0.5px = 1物理像素。
```

## 组件

通过组件的形式来代替html中的标签元素,类似于element-plus中的组件

### view组件

```ts
view组件 替代 div标签
```



### button组件

```ts
button组件 替代 button按钮 类似于 element-plus中的button组件

属性
	size
    type: primary(绿色) default白 warn红
	open-type
		contact	打开客服
        share	分享
        
```

使用案例

```xml
<button type="primary" size="mini" open-type="share">分享内容</button>
```



### text组件

```ts
text组件 替代 span标签
```



### image组件

```ts
image组件 替代 img标签

mode属性: 图片的裁剪和缩放
	scaleToFill 不保持比例缩放图片
    widthFix 	保持比例,宽度不变
	aspectFill  缩放模式，保持纵横比缩放图片
```

```xml
<view class="home">
    <view class="title">微信小程序基础语法</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" mode="aspectFill"/>
    <button type="primary" size="mini">按钮</button>
</view>
```

```less
/* pages/home/home.wxss */
.home{
    width: 100%;
    height: 100%;
    .title{
        width: 750rpx;
        height: 200rpx;
        background-color: aquamarine;
        text-align: center;
        line-height: 200rpx;
    }
}
```



### input组件

```ts
input组件 替代 input标签 类似于 element-plus中的input组件
```

### icon组件

微信内置图标组件 icon

```ts
<icon type="success" size="16" color="red"></icon>
```

### 阿里图标

**1 首先需要把阿里图标下载到本地**

```ts

```

**2 在static文件夹中新建一个样式文件 iconfont.wxss**

/static/iconfont.wxss

```css
把阿里图标下载下来的 css文件 复制,把本地的字体图标更换为在线的字体
```

3 在全局样式文件`app.wxss`中引入`wxss`文件

这样 iconfont.wxss 就变成了全局样式，全部的页面可以使用图标

```css
@import "/static/iconfont.wxss"
page{
	width:100%,
    height:100%
}    
```

**4 使用图标 /pages/home/home.wxml**

```xml
# 使用阿里图标 需要使用 iconfont 作为类名
<text class="iconfont icon-tubiaozhizuomoban-01"></text>
```

**5 调整图标的样式 /pages/home/home.wxss**

```css
# 调整阿里图标的图标大小和颜色
.iconfont{
    font-size:40px;
    background-color:red;
    color:red
}
```

**使用案例**

```xml
# index.wxml

<view class="home">
    <view class="title">微信小程序基础语法</view>
    <view>{{name}}</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" 
        style="transform:rotate({{deg}}deg)"
        class="avatar"
    />
    <view class="iconfont">
        <icon class="iconfont icon-baomirenyuan"/>
        <icon class="iconfont icon-gongsi"/>
    </view>
    
    <button type="primary" size="mini" catch:tap="handler">按钮1</button>
    <button type="primary" size="mini" bind:tap="add" style="margin-top: 20rpx;">按钮2</button>
</view>
```

```css
# index.wxss

.home{
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.home .title{
    width: 750rpx;
    height: 200rpx;
    background-color: aquamarine;
    text-align: center;
    line-height: 200rpx;
}
.home .avatar{
    width: 200rpx;
    height: 200rpx;
    border-radius: 50%;
    margin: 20rpx 0rpx;
}
.iconfont{
    display: flex;
    font-size: 40px;
    margin-bottom: 20rpx;
}
```

```ts
# index.js

//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //第一个按钮
    handler(event) {
        // 微信小程序的事件:window、document
        // 事件回调会注入事件对象
        // 微信小程序事件回调不能传递参数 catch:tap="handler(1,2,3)"
        // 修改页面的数据务必通过setData方法进行修改
        const newname = this.data.name + '❤';
        this.setData({
            name: newname
        })
    },
    //第二个按钮
    add() {
        this.setData({
            deg: this.data.deg + 10
        })
    }
})
```

```json
# app.json

{
    "pages": [
        "pages/index/index"
    ],
    "window": {
        "navigationBarBackgroundColor": "#ccc",
        "navigationBarTextStyle": "black",
        "navigationBarTitleText": "结城sakana"
    }
}
```

```css
# app.wxss

/**iconfont.wxss全局样式,全部的页面可以使用图标**/
@import "/static/iconfont.wxss";
page{
    width: 100%;
    height: 100%;
}
```

```js
# app.js
// 通过App内置函数:创建微信小程序应用
App({

    /**
     * 当小程序初始化完成时，会触发 onLaunch（全局只触发一次）
     */
    onLaunch: function () {

    },

    /**
     * 当小程序启动，或从后台进入前台显示，会触发 onShow
     */
    onShow: function (options) {

    },

    /**
     * 当小程序从前台进入后台，会触发 onHide
     */
    onHide: function () {

    },

    /**
     * 当小程序发生脚本错误，或者 api 调用失败时，会触发 onError 并带上错误信息
     */
    onError: function (msg) {

    }
})
```

```css
# /static/iconfont.wxss

@font-face {
    font-family: 'iconfont';  /* Project id 4749301 */
    src: url('//at.alicdn.com/t/c/font_4749301_a0gaqm2n8ms.woff2?t=1731899538449') format('woff2'),
         url('//at.alicdn.com/t/c/font_4749301_a0gaqm2n8ms.woff?t=1731899538449') format('woff'),
         url('//at.alicdn.com/t/c/font_4749301_a0gaqm2n8ms.ttf?t=1731899538449') format('truetype');
  }
  
  .iconfont {
    font-family: "iconfont" !important;
    font-size: 16px;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  .icon-canchuyongpin:before {
    content: "\e6bf";
  }
  
  .icon-huiyuanyonghu:before {
    content: "\e6c0";
  }
  
  .icon-remaituijian:before {
    content: "\e6c1";
  }
  
  .icon-lengdongmiandian:before {
    content: "\e6c2";
  }
  
  .icon-jingdianhuoguo:before {
    content: "\e6c3";
  }
  
  .icon-jingpinmeizhuang:before {
    content: "\e6c4";
  }
  
  .icon-shengxianshuiguo:before {
    content: "\e6c5";
  }
  
  .icon-shequdianpu:before {
    content: "\e6c6";
  }
  
  .icon-yangshengchadao:before {
    content: "\e6c7";
  }
  
  .icon-xiawucha:before {
    content: "\e6c8";
  }
  
  .icon-yuzhicaipin:before {
    content: "\e6c9";
  }
  
  .icon-baomirenyuan:before {
    content: "\101ce";
  }
  
  .icon-bangongqu:before {
    content: "\101cf";
  }
  
  .icon-chucha:before {
    content: "\101d0";
  }
  
  .icon-gongsi:before {
    content: "\101d1";
  }
  
  .icon-jianliku:before {
    content: "\101d2";
  }
  
  
```

### navigator组件

```ts
# 路由跳转的组件 声明式导航
```

### tabBar组件

```ts

```

### swiper组件

```ts
# 轮播图
滑块视图容器。其中只可放置swiper-item组件，否则会导致未定义的行为
仅可放置在swiper组件中，宽高自动设置为100%。
```

| 属性                   | 类型    | 默认值            |      | 说明                                                         |
| :--------------------- | :------ | :---------------- | :--- | :----------------------------------------------------------- |
| indicator-dots         | boolean | false             | 否   | 是否显示面板指示点                                           |
| indicator-color        | color   | rgba(0, 0, 0, .3) | 否   | 指示点颜色                                                   |
| indicator-active-color | color   | #000000           | 否   | 当前选中的指示点颜色                                         |
| autoplay               | boolean | false             | 否   | 是否自动切换                                                 |
| current                | number  | 0                 | 否   | 当前所在滑块的 index                                         |
| interval               | number  | 5000              | 否   | 自动切换时间间隔                                             |
| duration               | number  | 500               | 否   | 滑动动画时长                                                 |
| circular               | boolean | false             | 否   | 是否采用衔接滑动                                             |
| vertical               | boolean | false             | 否   | 滑动方向是否为纵向                                           |
| display-multiple-items | number  | 1                 | 否   | 同时显示的滑块数量                                           |
| previous-margin        | string  | "0px"             | 否   | 前边距，可用于露出前一项的一小部分，接受 px 和 rpx 值        |
| next-margin            | string  | "0px"             | 否   | 后边距，可用于露出后一项的一小部分，接受 px 和 rpx 值。skyline 于 3.5.1 版本支持 |
| easing-function        | string  | "default"         | 否   | 指定 swiper 切换缓动动画类型                                 |

```ts
default	默认缓动函数
linear	线性动画
easeInCubic	缓入动画
easeOutCubic	缓出动画
easeInOutCubic	缓入缓出动画
```



## 框架

框架中封装好的可以直接使用的内置函数 

### Page()函数

```ts
作用:	注册小程序中的一个页面。接受一个 Object 类型参数，其指定页面的初始数据、生命周期回调、事件处理函数等

参数:	Object对象
	data属性,作为页面的初始数据状态
    onShareAppMessage()方法 分享功能
```

**示例代码**

```xml
<view>{{text}}</view>
<view>{{array[0].msg}}</view>
```

```ts
Page({
    // 响应式数据
    data: {
        text: 'init data',
        array: [{msg: '1'}, {msg: '2'}]
    }
    // 方法
    changeText(){
    	console.log(window) // 这种写法是错误的,没有window
    	console.log(this) // this指向指向当前页面的配置对象(Page函数体内部对象)
	}
})
```

#### 分享钩子

**onShareAppMessage()**

用于分享功能

```ts
执行时机:系统左上角的三个点分享

分享功能,在页面,点击右上角的三个角时触发

监听用户点击页面内转发按钮（button 组件 open-type="share"）或右上角菜单“转发”按钮的行为，并自定义转发内容
```

```ts
注意：只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮
onShareAppMessage(params)
参数:
    params.from	区分系统分享还是自定义按钮分享menu是系统,button是自定义内容
    
返回值: 返回一个对象
	title		转发卡片标题
    path		转发卡片跳转路径
    imageUrl	转发卡片预览图片
```

使用案例

/pages/detail/detail.js

```js
Page({
    //详情页面生命周期函数onLoad
    onLoad(options) {
        console.log(options);
    },
    //系统左上角的三个点分享
    onShareAppMessage(params) {
        //params对象:from区分事件源 
        //menu:左上角三个按钮
        //button:自定义按钮
        if (params.from == 'menu') {
            //分享自定义内容
            return {
                title: '我来自系统三个点',
                path: "/pages/detail/detail",
                imageUrl: ''
            }
        }else{
            return {
                title: '自定义按钮分享',
                path: "/pages/detail/detail",
                imageUrl: '' 
            }
        }
    }
})
```

/pages/detail/detail.wxml

```xml
<!--pages/detail/detail.wxml-->
<view>我是详情</view>
<!-- 通过设置属性 open-type 为自定义转发按钮 -->
<button type="primary" size="mini" open-type="share">分享内容</button>
```

/pages/index/index.wxml

```xml
<view class="home">
    <view class="title">首页</view>
    <view>{{name}}</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" 
        style="transform:rotate({{deg}}deg)"
        class="avatar"
    />
    <view>声明式导航</view>
    <navigator url="/pages/detail/detail">
        <text class="iconfont icon-baomirenyuan" style="font-size: 80rpx;"></text>
    </navigator>
    <view>编程式导航</view>
    <button type="primary" size="mini" bind:tap="goDetail">
        <text class="iconfont icon-baomirenyuan"></text>
    </button>
</view>
```

/pages/index/index.js

```js
//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //编程式导航按钮回调
    goDetail(){
        //编程式导航页面跳转
        //navigateTo:A->B，但是A页面不会销毁(不能跳转到tabbar页面)
        //redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。
        wx.redirectTo({
          url: '/pages/detail/detail?a=1&b=2',
        })
    },
})
```



#### 页面生命周期钩子

```ts
onLoad		生命周期回调—监听页面加载
onShow		生命周期回调—监听页面显示
onReady		生命周期回调—监听页面初次渲染完成
onHide		生命周期回调—监听页面隐藏
onUnload	生命周期回调—监听页面卸载
```

使用案例

/pages/detail/detail.js

```js
Page({
    //详情页面生命周期函数onLoad
    onLoad(options) {
        console.log(options);
    },
    //系统左上角的三个点分享
    onShareAppMessage(params) {
        //params对象:from区分事件源 
        //menu:左上角三个按钮
        //button:自定义按钮
        if (params.from == 'menu') {
            //分享自定义内容
            return {
                title: '我来自系统三个点',
                path: "/pages/detail/detail",
                imageUrl: ''
            }
        }else{
            return {
                title: '自定义按钮分享',
                path: "/pages/detail/detail",
                imageUrl: '' 
            }
        }
    }
})
```

/pages/detail/detail.wxml

```xml
<!--pages/detail/detail.wxml-->
<view>我是详情</view>
<!-- 通过设置属性 open-type 为自定义转发按钮 -->
<button type="primary" size="mini" open-type="share">分享内容</button>
```

/pages/index/index.wxml

```xml
<view class="home">
    <view class="title">首页</view>
    <view>{{name}}</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" 
        style="transform:rotate({{deg}}deg)"
        class="avatar"
    />
    <view>声明式导航</view>
    <navigator url="/pages/detail/detail">
        <text class="iconfont icon-baomirenyuan" style="font-size: 80rpx;"></text>
    </navigator>
    <view>编程式导航</view>
    <button type="primary" size="mini" bind:tap="goDetail">
        <text class="iconfont icon-baomirenyuan"></text>
    </button>
</view>
```

/pages/index/index.js

```js
//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //编程式导航按钮回调
    goDetail(){
        //编程式导航页面跳转
        //navigateTo:A->B，但是A页面不会销毁(不能跳转到tabbar页面)
        //redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。
        wx.redirectTo({
          url: '/pages/detail/detail?a=1&b=2',
        })
    },
})
```

#### 页面滑动钩子

onPageScroll()

```ts
onPageScroll()
监听用户滑动页面事件

参数 Object object
```

| 属性      | 类型   | 说明                                 |
| :-------- | :----- | :----------------------------------- |
| scrollTop | Number | 页面在垂直方向已滚动的距离（单位px） |

```ts
//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //编程式导航按钮回调
    goDetail(){
        //编程式导航页面跳转
        //navigateTo:A->B，但是A页面不会销毁(不能跳转到tabbar页面)
        //redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。
        wx.redirectTo({
          url: '/pages/detail/detail?a=1&b=2',
        })
    },
    // 监听页面滚动
    onPageScroll(event){
        console.log(event) // 返回一个像素位置
    }
})
```



### setData()函数

用于页面响应式数据,类似于 react中的setState

```ts
调用者:指向当前页面的配置对象(Page函数体内部对象)
this.setData()
参数：对象{},对象中的属性和属性值会替换旧的属性和属性值
返回值：无
```

```ts
handle(){
    // 这种不是响应式数据,需要使用 setData函数设置 数据状态才是响应式
    console.log(this.data.msg += 1) // this 指向当前页面的配置对象(Page函数体内部对象)
    const newMsg = this.data.msg + 1;
    // 设置响应式数据
    this.setData({
        msg:newMsg
    })
}
```

## 事件

### 单击事件

在组件上绑定点击事件，通过 `bind:tap`或` bindtap `设置，类似 `@click=""`作用

`微信小程序事件的回调不能够传参(只有默认的event对象)`

`event是当前点击的元素对象`

`可以结合event对象和自定义属性(data-属性名)实现传递参数`

```ts
绑定事件 有两种方式: bind:tap(冒泡) catch:tap(不冒泡)
```

```ts
<button type="primary" size="mini" bind:tap="handle" data-flag="1">按钮1</button>
<button type="primary" size="mini" catch:tap="handle1">按钮2</button>
```

```ts
Page({
    data: {
        msg:1
        text: 'init data',
        array: [{msg: '1'}, {msg: '2'}]
    }
	// 事件的回调不能够传参,可以使用自定义属性(data-属性名)在标签上,然后通过 event获取属性值
    handle(event){
        console.log(event.currentTarget.dataSet.flag) // event是当前点击的元素对象
        const newMsg = this.data.msg + 1; // (正确的)
        
        this.setData({
            msg:newMsg
        })
	}
})
```

**使用案例1**

/pages/index/index.js

```ts
Page({
    data: {
        msg:1
        text: 'init data',
        array: [{msg: '1'}, {msg: '2'}]
    },
    handle(){
        // 这种不是响应式数据,需要使用 setData函数设置 数据状态才是响应式
        // this 指向当前页面的配置对象(Page函数体内部对象)
        const newMsg = this.data.msg + 1;
        // 设置响应式数据
        this.setData({
            msg:newMsg
        })
	}
})
```

```ts
Component({
  data: {
    msg:445
  },
  methods: {
    // 事件处理函数
    handle(){
        // 这种不是响应式数据,需要使用 setData函数设置 数据状态才是响应式
        // this 指向当前页面的配置对象(Page函数体内部对象)
        const newMsg = this.data.msg + 1;
        console.log(newMsg)
        // 设置响应式数据
        this.setData({
            msg:newMsg
        })
	}
  },
})
```

/pages/index/index.wxml

```xml
<view style="margin-top:100px;text-align: center;">测试</view>
<text>{{msg}}</text>
<button type="primary" size="mini" bind:tap="handle">点我</button>
```

**使用案例2**

home.wxml

```xml
<!-- tab选项卡 -->
<view class="tab">
    <!-- 事件的回调不能够传参,可以使用自定义属性(data-属性名)在标签上,然后通过 event获取属性值 -->
    
    <view class="item {{flag==1?'active':''}}" bind:tap="handlerClick" data-flag="1">一生期</view>
    <view class="item {{flag==2?'active':''}}" bind:tap="handlerClick" data-flag="2">二生期</view>
    <view class="item {{flag==3?'active':''}}" bind:tap="handlerClick" data-flag="3">三生期</view>
</view>
<view class="first" wx:if="{{flag==1}}">
    <view>fubuki</view>
</view>
<view class="second" wx:if="{{flag==2}}">
    <view>shiyin</view>
</view>
<view class="third" wx:if="{{flag==3}}">
    <view>xingjiesuisui</view>
</view>
```

home.js

```js
// 获取点击对象
    handlerClick(event){ // event是当前点击的元素对象
        // 获取点击这个元素自定义属性的属性值
        const newFlag = event.currentTarget.dataset.flag
        // 修改数据状态
        this.setData({
            flag:newFlag
        })
    }
```

home.wxss

```css
.tab{
    display: flex;
}
.tab .item{
    /* 伸缩容器被瓜分完 */
    flex:1;
    text-align: center;
    line-height: 40rpx;
    border: 2rpx solid #ccc;
}
.tab .active{
    background: aquamarine;
}
```

## 指令

微信小程序中的指令只支持三种

```ts
wx:if
wx:else
wx:for
```

### 列表渲染

```ts
wx:for
在组件上使用 wx:for 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。
默认数组的当前项的下标变量名默认为 index，数组当前项的变量名默认为 item

wx:key 指定唯一的标识
	wx:key 的值以两种形式提供
    	字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变(数组对象中的属性名,而不是属性值)
        保留关键字 *this 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字

wx:for-item 可以指定数组当前元素的变量名,起别名
wx:for-index 可以指定数组当前下标的变量名,起别名
```

**使用案例**

home.js

```js
Page({
    data: {
        todos:[
            {
                id:1,
                title:'阿夸'
            },
            {
                id:2,
                title:'mea'
            },
            {
                id:3,
                title:'sakuna'
            }
        ]
        
    },
})
```

home.wxml

```xml
<view>列表渲染</view>
<!-- {{}} 差值表达式中 写的是 data 中的数组数据属性名 -->
<text wx:for="{{todos}}" wx:for-item="aqua" wx:key='id'>{{index}}:{{aqua.title}}</text>

```

### 显示隐藏

```ts
wx:if  		控制元素的显示与隐藏 类似于 v-if
wx:else		控制元素的显示与隐藏,配合wx:if使用
hidden 		控制元素显示与隐藏,不是销毁类似于 v-show
```

**使用案例**

home.js

```ts
Page({
    data: {
        todos:[],
        visite:false
        
    },
     handle(){
        newVisite = !this.data.visite
        // 设置响应式数据
        this.setData({
            visite:newVisite
        })
	}
})
```

home.wxml

```ts
// 控制元素的显示与隐藏 类似于 v-if
<view wx:if="{{visite}}">aqua</view>
// 控制元素的显示与隐藏,配合wx:if使用
<view wx:else>mea</view>
// 控制元素显示与隐藏,不是销毁类似于 v-show
<view hidden="{{visite}}">nano</view>

<button type="primary" size="mini" bind:tap="handle">显示与隐藏</button>
```



## 插值表达式

微信小程序中的插值表达式可以在 组件属性的属性值上直接设置

```ts
<view style="margin-top:{{font}}px">{{msg}}</view>
// <view :style="{fontSize:}">{{msg}}</view> // vue的写法,在微信中不可用
Page({
    data: {
        msg:1
        font: '16',
        
    },
    handle(){
        // 这种不是响应式数据,需要使用 setData函数设置 数据状态才是响应式
        // this 指向当前页面的配置对象(Page函数体内部对象)
        const newMsg = this.data.font + 1;
        // 设置响应式数据
        this.setData({
            font:newMsg
        })
	}
})
```

## 路由

### 路由跳转

```ts
页面的跳转方式有两种
	编程式导航	类似于 router.push(...)
    声明式导航 	类似于 <router-link :to="...">
```

案例

```ts
# 新建一个文件夹detail,用于存放详情的页面
# 设置页面的标题

```

### 声明式导航

```ts
navigitor组件
属性
    # url			当前小程序内的跳转链接		string
    # open-type	跳转方式				 string 默认跳转方式 navigate	
        # navigate	保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面(对应 wx.navigateTo)
        # redirect	关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面(对应 wx.redirectTo 的功能)
```

### 编程式导航

```ts
wx.navigateTo(Object object)
wx.redirectTo(Object object)
```

```ts
wx.navigateTo(Object object)
对象中属性:
	url		string	需要跳转的应用内非 tabBar 的页面的路径,路径后可以带参数,如 'path?key=value&key2=value2'
	events	object 	页面间通信接口，用于监听被打开页面发送到当前页面的数据
    success	function	接口调用成功的回调函数
	fail	function	接口调用失败的回调函数
	complete function	接口调用结束的回调函数（调用成功、失败都会执行）
```

**使用案例**

```ts
//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //编程式导航按钮回调
    goDetail(){
        //编程式导航页面跳转
        //navigateTo:A->B，但是A页面不会销毁(不能跳转到tabbar页面)
        //redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。
        wx.redirectTo({
          url: '/pages/detail/detail?a=1&b=2',
        })
    },
})
```

```ts
<view class="home">
    <view class="title">首页</view>
    <view>{{name}}</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" 
        style="transform:rotate({{deg}}deg)"
        class="avatar"
    />
    <view>声明式导航</view>
    <navigator url="/pages/detail/detail">
        <text class="iconfont icon-baomirenyuan" style="font-size: 80rpx;"></text>
    </navigator>
    <view>编程式导航</view>
    <button type="primary" size="mini" bind:tap="goDetail">
        <text class="iconfont icon-baomirenyuan"></text>
    </button>
</view>
```

```css
.home{
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.home .title{
    width: 750rpx;
    height: 200rpx;
    background-color: aquamarine;
    text-align: center;
    line-height: 200rpx;
}
.home .avatar{
    width: 200rpx;
    height: 200rpx;
    border-radius: 50%;
    margin: 20rpx 0rpx;
}
```

```xml
<!--pages/detail/detail.wxml-->
<text>pages/detail/detail.wxml</text>
```



## 全局对象API

wx. wx是微信小程序中的全局对象,每一个页面中都可以使用,他身上有很多API方法

### wx.navigateTo(Object)

```ts
wx.navigateTo(Object object)
作用：保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面

对象中属性:
	url		string	需要跳转的应用内非 tabBar 的页面的路径,路径后可以带参数,如 'path?key=value&key2=value2'
	events	object 	页面间通信接口，用于监听被打开页面发送到当前页面的数据
    success	function	接口调用成功的回调函数
	fail	function	接口调用失败的回调函数
	complete function	接口调用结束的回调函数（调用成功、失败都会执行）
```

### wx.redirectTo(Object)

```ts
wx.redirectTo(Object object)
作用：关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。

对象中属性:
	url		string	需要跳转的应用内非 tabBar 的页面的路径,路径后可以带参数,如 'path?key=value&key2=value2'
	events	object 	页面间通信接口，用于监听被打开页面发送到当前页面的数据
    success	function	接口调用成功的回调函数
	fail	function	接口调用失败的回调函数
	complete function	接口调用结束的回调函数（调用成功、失败都会执行）
```

### wx.pageScrollTo(Object)

```ts
将页面滚动到目标位置，支持选择器和滚动距离两种方式定位
```

| 属性      | 类型     | 默认值 | 必填 | 说明                                                         |
| :-------- | :------- | :----- | :--- | :----------------------------------------------------------- |
| scrollTop | number   |        | 否   | 滚动到页面的目标位置，单位 px                                |
| duration  | number   | 300    | 否   | 滚动动画的时长，单位 ms                                      |
| selector  | string   |        | 否   | 选择器                                                       |
| offsetTop | number   |        | 否   | 偏移距离，需要和 selector 参数搭配使用，可以滚动到 selector 加偏移距离的位置，单位 px |
| success   | function |        | 否   | 接口调用成功的回调函数                                       |
| fail      | function |        | 否   | 接口调用失败的回调函数                                       |
| complete  | function |        | 否   | 接口调用结束的回调函数（调用成功、失败都会执行）             |

## 生命周期

```ts
https://developers.weixin.qq.com/miniprogram/dev/reference/api/Page.html
```

### 应用级

在app.js中的App()函数内调用执行，应用级别的钩子函数

```ts
onLaunch	小程序初始化完成时,触发onLaunch(全局只触发一次)
onShow		小程序启动,或从后台进入前台显示触发
onHide		小程序隐藏时,触发
onError		小程序发生错误时,触发
```

### 页面级

在index.js中的Page()函数内调用执行，页面级别的钩子函数

```ts
onLoad		生命周期回调—监听页面加载
onShow		生命周期回调—监听页面显示
onReady		生命周期回调—监听页面初次渲染完成
onHide		生命周期回调—监听页面隐藏
onUnload	生命周期回调—监听页面卸载
```

#### onLoad()

页面加载时触发。一个页面只会调用一次，可以在 onLoad 的参数中获取打开当前页面路径中的参数。

可以获取页面中参数

**参数**

| 名称  | 类型   | 说明                     |
| ----- | ------ | ------------------------ |
| query | Object | 打开当前页面路径中的参数 |

使用案例

/pages/detail/detail.js

```js
Page({
    //详情页面生命周期函数onLoad
    onLoad(options) {
        console.log(options);
    },
    //系统左上角的三个点分享
    onShareAppMessage(params) {
        //params对象:from区分事件源 
        //menu:左上角三个按钮
        //button:自定义按钮
        if (params.from == 'menu') {
            //分享自定义内容
            return {
                title: '我来自系统三个点',
                path: "/pages/detail/detail",
                imageUrl: ''
            }
        }else{
            return {
                title: '自定义按钮分享',
                path: "/pages/detail/detail",
                imageUrl: '' 
            }
        }
    }
})
```

/pages/detail/detail.wxml

```xml
<!--pages/detail/detail.wxml-->
<view>我是详情</view>
<!-- 通过设置属性 open-type 为自定义转发按钮 -->
<button type="primary" size="mini" open-type="share">分享内容</button>
```

/pages/index/index.wxml

```xml
<view class="home">
    <view class="title">首页</view>
    <view>{{name}}</view>
    <image src="https://2216847528.oss-cn-beijing.aliyuncs.com/asset/20241118104045.png" 
        style="transform:rotate({{deg}}deg)"
        class="avatar"
    />
    <view>声明式导航</view>
    <navigator url="/pages/detail/detail">
        <text class="iconfont icon-baomirenyuan" style="font-size: 80rpx;"></text>
    </navigator>
    <view>编程式导航</view>
    <button type="primary" size="mini" bind:tap="goDetail">
        <text class="iconfont icon-baomirenyuan"></text>
    </button>
</view>
```

/pages/index/index.js

```js
//通过Page方法创建页面   App->Page
Page({
    //页面数据
    data: {
        name: '结城sakuna',
        deg:0,
    },
    //编程式导航按钮回调
    goDetail(){
        //编程式导航页面跳转
        //navigateTo:A->B，但是A页面不会销毁(不能跳转到tabbar页面)
        //redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。
        wx.redirectTo({
          url: '/pages/detail/detail?a=1&b=2',
        })
    },
})
```

