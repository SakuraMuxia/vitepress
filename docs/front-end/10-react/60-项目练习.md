# 项目练习

## 初始化项目

### 克隆项目

由于此项目是一个二次开发的项目，于是首先克隆项目代码

```shell
git clone https://gitee.com/yuonly0528/react-project.git
```

### 安装依赖

**修改镜像源(可选)**

```shell
# 腾讯
npm config set registry http://mirrors.cloud.tencent.com/npm
# 淘宝
npm config set registry https://registry.npmmirror.com
# npm 原镜像
npm config set registry https://registry.npmjs.org

# 查看npm配置
npm config list

# 设置npm代理
npm config set proxy http://<username>:<password>@<proxy-server-url>:<port>
npm config set proxy http://127.0.0.1:7890
npm config set https-proxy http://127.0.0.1:7890

# 删除npm代理
npm config delete proxy
npm config delete https-proxy
```

**安装依赖**

```shell
npm i -f  # -f force 强制安装
```

**启动项目**

```shell
npm start
```

**可能出现的问题**

```shell
1. 由于网络原因，导致包没下全。
   1. 删除node_modules : 切换源 重新 npm i -f安装
   2. 叉掉错误：对付用
2. token异常：
   1. 删除本地存储的token，刷新页面重新登录
```

## 项目接口地址

- 医院接口地址：http://139.198.34.216:8201/swagger-ui.html#/
- 数据字典接口地址：http://139.198.34.216:8202/swagger-ui.html#/259682545423383208563164929702
- 登录接口地址：http://139.198.34.216:8212/swagger-ui.html
- [医院管理接口文档](http://139.198.34.216:8201/swagger-ui.html)
- [用户登录接口文档](http://139.198.34.216:8230/doc.html)
- [数据字典接口文档](http://139.198.34.216:8202/swagger-ui.html)
- [用户管理接口文档](http://139.198.34.216:8203/swagger-ui.html)
- [订单管理接口文档](http://139.198.34.216:8206/swagger-ui.html)

### 测试接口

测试接口也叫对接口，联调接口。

我们可以使用 `swagger` `postman` 工具来测试接口。使用swagger来搭建接口测试

测试接口目的：要保证接口是按照接口文档完成的，没有问题。这样未来我们开发时就不用考虑接口出错的原因了。

### 技术选型

- react@18 框架
- 全面使用hook函数组件
- react-router-dom@6 前端路由
- redux 集中状态管理方案
- axios 发送请求函数
- antd UI 库
- typescript
- nprogress 进度条
- create-react-app 脚手架
- craco 修改脚手架配置
- i18next & react-i18next i18n国际化
- echarts 数据可视化

### 项目开发流程

1. 项目立项（管理层）
2. 项目需求分析（市场部）

​			`产出`：项目需求文档( 产品经理 )

3. 设计产品原型 (关键)  (axure)

​			`产出`：项目原型图/草图(产品经理)

4. 产品开会

​			产品经理召集`前端、后端、UI、测试`开会。

*   对于前端来说：

    - 产品经理会给我们介绍项目需求具体情况，我们需要尽可能搞清楚需求，同时需要敲定需求完成时间。

    - UI 提供项目`UI原型图/标注图`。

    - 后端提供`接口文档`。

    - 认识对接后端、UI、测试、产品同事。

5. 前端开发

   - 根据后端提供开发的接口文档`测试接口`

   - 按照需求文档要求`开发项目功能`


6. 测试
7. 上线

### Demo演示

```shell
前台尚医通挂号平台(前台)在线访问地址: 
- http://syt-h5.atguigu.cn/
- http://syt.atguigu.cn/
```

## 项目配置

由于react项目为了限制私自更改webpack配置，所以react项目中没有webpack的配置文件`webpack.config.js`，于是为了修改webpack的配置文件，就需要用到 `craco`,通过craco配置，然后再引入到webpack配置中实现自定义webpack配置

配置`craro.config.js`

```js
const CracoLessPlugin = require("craco-less");
const CracoAlias = require("craco-alias");

module.exports = {
    plugins: [
        // 自定义主题
        {
            plugin: CracoLessPlugin,
            options: {
                lessLoaderOptions: {
                    lessOptions: {
                        modifyVars: { "@primary-color": "#1DA57A" },
                        javascriptEnabled: true,
                    },
                },
            },
        },
        // 路径别名
        {
            plugin: CracoAlias,
            options: {
                source: "tsconfig",
                baseUrl: "./",
                tsConfigPath: "./tsconfig.extend.json",
            },
        },
    ],
    // 开发服务器配置
    devServer: {
        // 激活代理服务器
        proxy: {
            // 将来以/dev-api开头的请求，就会被开发服务器转发到目标服务器去。
            "/dev-api": {
                // 需要转发的请求前缀
                target: "http://syt-api.atguigu.cn", // 目标服务器地址
                changeOrigin: true, // 允许跨域
                pathRewrite: {
                    // 路径重写
                    "^/dev-api": "",
                },
            },
        },
    },
};

```

配置`package.json`

```json
"scripts": {
    "start": "craco start",
    "build": "craco build",
    "test": "craco test",
    // 这里的eject作用就是把craco的配置引入到webpack中
    "eject": "react-scripts eject"
  },
```



### 路径别名

开发时当组件层级太深时，我们引入其他目录下文件需要回退很多层目录，很麻烦。

路径别名则提供另外一种写路径的方式，或者说路径简写，让我们可以从根路径出发直接写路径，简单方便。

配置文件：`tsconfig.extend.json`

```json
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"],
      "@api/*": ["src/api/*"],
      "@assets/*": ["src/assets/*"],
      "@comps/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"],
      "@pages/*": ["src/pages/*"]
    }
  }
}
```

通过插件将上述配置加载到 `craco.config.js` , 最终会修改 `React` 脚手架配置，所以就可以项目中使用上述路径别名。

配置 `craco.config.js`

```js
// 路径别名
{
  plugin: CracoAlias,
  options: {
    source: "tsconfig",
    tsConfigPath: "./tsconfig.extend.json",
  },
},
```

### 路径提示

通过 extends 将上述配置加载到 `tsconfig.json` 中，此时在 `VSCode` 写代码才会有路径提示

配置`tsconfig.json`

```json
{
	"extends": "./tsconfig.extend.json",
}
```

我们将来如果要添加新的路径别名，只需要修改 `tsconfig.extend.json` 即可

### 设置代理服务器

- 代理服务器可以解决开发时的跨域问题。
- React脚手架本身提供的配置方式只支持单个代理
- 如果开发中需要有多个如何处理?   ==> 利用craco工具来配置

**代理服务器配置**

配置`craco.config.js`

```js
module.exports = {
	
  ...
  ...
  
	// 开发服务器配置
	devServer: {
		// 激活代理服务器
		proxy: {
			// 拦截以/dev-api开头的请求，就会被代理服务器拦截并转发到目标服务器去。
			"/dev-api": { // 需要转发的请求前缀
				target: "http://syt-api.atguigu.cn", // 目标服务器地址
				changeOrigin: true, // 为true时代理在转发时, 会将请求头的host改为target的值
				pathRewrite: { // 路径重写, 在转发请求时自动去除路径的/dev-api
					"^/dev-api": "",
				},
        	// 可以在下面配置多个代理
        	
			},
		},
	},
  
  
};
```

```js
需要注意的是，一旦生产环境打包项目，服务器以及相关配置并不会打包进去，所以如果运行打包后的项目，还会产生跨域问题。

最终还是需要服务端来解决，将来我们会学习 `nginx` 来解决此问题

项目中的baseUrl 需要和nginx中http根目录一致。
设置反向代理
```

### 环境变量设置

这里的环境变量是指node在运行时能够使用 `process.env`属性获取到的变量，这些变量定义在`.env.development`和`.env.production`中，具体使用哪一个文件中的变量，需要根据`webpack.config.js`中`Mode`属性的配置(dev or prod)

`.env.development`文件配置

```js
REACT_APP_MOCK_API = '/mock-api'
REACT_APP_API = '/dev-api'
```

`.env.production`文件配置

```js
REACT_APP_API = '/prod-api'
```



## 项目目录介绍

```shell
├── public # 公共静态资源目录
│   ├── favicon.ico # 网站图标
│   ├── index.html # 主页面
├── src # 主目录
│   ├── api # 接口文件
│   ├── app # redux配置文件
│   ├── components # 公共组件
│   │   ├── Loading # loading组件
│   │   ├── Translation # 国际化组件
│   │   └── withAuthorization # 登陆权限校验组件
│   ├── layouts # 主要布局组件
│   ├── locales # i18n国际化配置
│   ├── pages # 路由组件
│   ├── routes # 路由配置
│   ├── styles # 全局/公共样式
│   ├── utils # 工具函数
│   │   └── http # 封装请求函数
│   ├── App.tsx # App组件
│   ├── index.ts # 主入口
│   ├── react-app-env.d.ts # 类型文件，在编译时会引入额外文件
├── .env.development # 开发环境加载的环境变量配置
├── .env.production # 生产环境加载的环境变量配置
├── .gitignore # git忽略文件
├── craco.config.js # react脚手架配置文件
├── package.json # 包文件
├── README.md # 项目说明文件
├── tsconfig.extend.json # 路径别名配置文件
├── tsconfig.json # ts配置文件
└── yarn.lock # yarn下载包的缓存文件
```

## 实现功能步骤

```shell
1. 创建路由组件
2. 配置路由
3. 创建组件的静态结构
4. 查看接口
   1. 封装 interface 
   2. 封装 api 函数 
5. 调用 api 函数
   1. 事件回调
   2. 钩子函数  
6. 声明状态 
```

## 医院管理功能实现

### 创建路由组件

创建路由组件：src/pages/hospital/hospitalSet/hospitalSet.tsx

```tsx
import React from 'react'
import { Button, Card, Form, Input, Space, Table } from 'antd'
import { ColumnsType } from 'antd/lib/table'
export default function hospitalSet() {
    // 定义一个静态数据:列数据
    const columns:ColumnsType<any> = [
        {
            title: '序号'
        },
        {
            title: '医院名称'
        },
        {
            title: '医院编号'
        },
        {
            title: 'api基础路径'
        },
        {
            title: '签名'
        },
        {
            title: '联系人姓名'
        },
        {
            title: '联系人手机'
        },
        {
            title: '操作'
        }
    ]

    return (
        <Card>
            {/* Form、Select不支持className，只能用style写样式 */}
            <Form
                layout='inline'
            >
                <Form.Item>
                    <Input placeholder='医院名称' />
                </Form.Item>
                <Form.Item>
                    <Input placeholder='医院编号' />
                </Form.Item>
                <Form.Item>
                    <Space>
                        <Button type='primary'>查询</Button>
                        <Button>清空</Button>
                    </Space>
                </Form.Item>
            </Form>
            {/* 这里的className:mt 是在 src/style/index.css引入的全局样式 */}
            <Space className='mt'>
                <Button type='primary'>添加</Button>
                <Button disabled>批量删除</Button>
            </Space>

            <Table
                className='mt'
                columns={columns}
            />

        </Card>
    )
}
```

### 路由配置

配置路由：src/routes/index.tsx

```tsx
// src/routes/index.tsx
import { lazy, Suspense, FC } from "react";
import { useRoutes, Navigate } from "react-router-dom";
import { HomeOutlined, ShopOutlined } from "@ant-design/icons";
import type { XRoutes } from "./types";

// import { Translation } from "react-i18next";

import {
    Layout,
    EmptyLayout,
    // CompLayout
} from "../layouts";
import Loading from "@comps/Loading";

const Login = lazy(() => import("@pages/login"));
const Dashboard = lazy(() => import("@pages/dashboard"));
const NotFound = lazy(() => import("@pages/404"));
const hospitalSet = lazy(() => import("@/pages/hospital/hospitalSet/hospitalSet"));

// 定义load函数：用于懒加载
const load = (Comp: FC) => {
    return (
        // 因为路由懒加载，组件需要一段网络请求时间才能加载并渲染
        // 在组件还未渲染时，fallback就生效，来渲染一个加载进度条效果
        // 当组件渲染完成时，fallback就失效了
        <Suspense fallback={<Loading />}>
            {/* 所有lazy的组件必须包裹Suspense组件，才能实现功能 */}
            <Comp />
        </Suspense>
    );
};

// 路由配置
const routes: XRoutes = [
    {
        path: "/",
        // (带逻辑判断组件:如果登陆过就重定向到当前目录,若未登录重定向到登陆页面)
        element: <EmptyLayout />,
        children: [
            {
                path: "login",
                element: load(Login),
            },
        ],
    },
    {
        path: "/syt",
        // (带逻辑判断组件: 如果登陆过就重定向到dashboard页面, 若未登录重定向到登陆页面)
        element: <Layout />,
        children: [
            {
                // 路由路径
                path: "/syt/dashboard",
                meta: {
                    icon: <HomeOutlined />,
                    title: '首页'
                },
                element: load(Dashboard),
            },
            {
                // 路由路径
                path: "/syt/hospital",
                meta: {
                    icon: <ShopOutlined />,
                    title: '医院管理'
                },
                children: [
                    {
                        path: '/syt/hospital/hospitalSet',
                        meta: {
                            title: '医院设置'
                        },
                        element: load(hospitalSet)
                    }
                ]
            }
        ],
    },

    {
        path: "/404",
        element: load(NotFound),
    },

    {
        path: "*", // 任意路径：除了上面路径以外其他路径
        element: <Navigate to="/404" />,
    },
];

/* 
自定义hook: 注册应用的所有路由
*/
export const useAppRoutes = () => {
    return useRoutes(routes);
};

// 找到要渲染成左侧菜单的路由
export const findSideBarRoutes = () => {
    const currentIndex = routes.findIndex((route) => route.path === "/syt");
    return routes[currentIndex].children as XRoutes;
};

export default routes;

```

### 定义响应体类型

```shell
查看接口：【请求方式、url、参数、返回值】
封装interface： 返回值
封装api函数：
	方式1. path: request.请求方式<any,响应值类型>(url/参数1/参数2...)
	方式2. query: request.请求方式<any,响应值类型>(url, 
		{params:参数key:参数值}
	)
```

定义request：项目文件初始化的时候已经创建了(二次开发)

定义响应体类型：src/api/hospital/model/hospitalType.ts

```ts
/**
 * 医院设置每一项对象类型
 */
export interface IHospitalSetItem {
    id: number;
    createTime: string;
    hosname: string;
    hoscode: string;
    apiUrl: string;
    signKey: string;
    contactsName: string;
    contactsPhone: string;
    status: number
}
/**
 * 医院设置列表类型
 */
export type IHospitalSetList = IHospitalSetItem[]
/**
 * 医院设置分页 响应数据类型
 */
export interface IHospitalSetListResponse {
    records: IHospitalSetList;
    total: number;
}
```

定义请求api：src/api/hospital/hospitalSet.ts

```ts
import { request } from '@utils/http'
import { IHospitalSetListResponse } from './model/hospitalSetType'

/**
 * 医院设置相关api函数
 * @param page 当前页 必填
 * @param limit 每页几条 必填
 * @param hosname 医院名称
 * @param hoscode 医院编号
 * @returns 
 */
export const getHospitalSetList = (page: number, limit: number, hosname?: string, hoscode?: string) => {
    return request.get<any, IHospitalSetListResponse>(`/admin/hosp/hospitalSet/${page}/${limit}`, {
        params: {
            hosname,
            hoscode
        }
    })
}
```

### 调用API渲染数据

通过以下两种方式调用API

```ts
1. 事件回调
2. 钩子函数:生命周期 useEffect()
```

渲染数据：设置列数据的dataIndex属性（antd中语法）

```ts
1. 定义数据状态
2. 设置状态（修改数据状态）
```

src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
import React, { useEffect, useState } from 'react'
import { Button, Card, Form, Input, Space, Table } from 'antd'
import { EditOutlined, DeleteOutlined } from '@ant-design/icons'
import { ColumnsType } from 'antd/lib/table'
import { IHospitalSetList } from '@/api/hospital/model/hospitalSetType'
import { getHospitalSetList } from '@/api/hospital/hospitalSet'
export default function HospitalSet() {
    // 定义一个静态数据:列数据
    const columns: ColumnsType<any> = [
        {
            // 手动计算序号
            title: '序号',
            render(value: any, row: any, index: number) {
                return (current - 1) * pageSize + (index + 1)
            }
        },
        {
            title: '医院名称',
            dataIndex: 'hosname'
        },
        {
            title: '医院编号',
            dataIndex: 'hoscode'
        },
        {
            title: 'api基础路径',
            dataIndex: 'apiUrl'
        },
        {
            title: '签名',
            dataIndex: 'signKey'
        },
        {
            title: '联系人姓名',
            dataIndex: 'contactsName'
        },
        {
            title: '联系人手机',
            dataIndex: 'contactsPhone'
        },
        {
            title: '操作',
            render(row: any) {
                return (
                    <Space>
                        <Button type='primary' icon={<EditOutlined />}>编辑</Button>
                        <Button type='primary' icon={<DeleteOutlined />} danger>删除</Button>
                    </Space>
                )
            }
        }
    ]
    // 数据状态
    // 分页相关状态
    let [current, setCurrent] = useState<number>(1);
    let [pageSize, setPageSize] = useState<number>(3);
    let [total, setTotal] = useState<number>(10);
    // 医院设置列表类型
    let [hospitalSetList, setHospitalSetList] = useState<IHospitalSetList>([]);
    let [hosname, setHosname] = useState<string>();
    let [hoscode, setHoscode] = useState<string>();
    // 定义异步请求
    async function _getHospitalSetList() {
        let { records, total } = await getHospitalSetList(current, pageSize, hosname, hoscode);
        // 设置状态
        setHospitalSetList(records);
        setTotal(total);
    }
    // 声明周期 
    useEffect(() => {
        // 调用异步请求
        _getHospitalSetList();
    }, [current, pageSize])

    return (
        <Card>
            <Form
                layout='inline'
            >
                <Form.Item>
                    <Input placeholder='医院名称' />
                </Form.Item>
                <Form.Item>
                    <Input placeholder='医院编号' />
                </Form.Item>
                <Form.Item>
                    <Space>
                        <Button type='primary'>查询</Button>
                        <Button>清空</Button>
                    </Space>
                </Form.Item>
            </Form>

            {/* 这里的className:mt 是在 src/style/index.css引入的全局样式 */}
            <Space className='mt'>
                <Button type='primary'>添加</Button>
                <Button disabled>批量删除</Button>
            </Space>

            <Table
                className='mt'
                rowKey={'id'}
                columns={columns}
                dataSource={hospitalSetList}
                pagination={{
                    current,
                    pageSize,
                    total,
                    showQuickJumper: true,
                    showSizeChanger: true,
                    pageSizeOptions: [3, 5, 10, 20],
                    onChange: (page: number, pageSize: number) => {
                        setCurrent(page);
                        setPageSize(pageSize)
                    }
                }}
            />
        </Card>
    )
}
```

### 设置表格loading效果

src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
...
// 设置loading状态
	let [loading,setLoading] = useState<boolean>(false);

// 定义异步请求
    async function _getHospitalSetList() {
        setLoading(true);
        let { records, total } = await getHospitalSetList(current, pageSize, hosname, hoscode);
        // 设置状态
        setHospitalSetList(records);
        setTotal(total);
        setLoading(false);
    }
...
<Table
    className='mt'
	...
    loading={loading}
    ...
/>
```

### 列宽度列固定滚动条

可以查阅 antd官方文档中的Table组件中API查看更多属性

src/pages/hospital/hospitalSet/hospitalSet.tsx

```tsx

const columns: ColumnsType<any> = [
    {
        // 手动计算序号
        title: '序号',
        // 设置宽度
        width:60,
        align:'center',
        render(value: any, row: any, index: number) {
            return (current - 1) * pageSize + (index + 1)
        }
    },
    {
        title: '操作',
        width:120,
        // 设置固定定位
        fixed:'right',
        render(row: any) {
            return (
                <Space>
                    <Button type='primary' icon={<EditOutlined />}>编辑</Button>
                    <Button type='primary' icon={<DeleteOutlined />} danger>删除</Button>
                </Space>
            )
        }
    }
]

return (
    <Table
        className='mt'
        rowKey={'id'}
        columns={columns}
        dataSource={hospitalSetList}
        loading={loading}
        // 设置宽度
        scroll={{x:1300}}
        pagination={{
            current,
            pageSize,
            total,
            showQuickJumper: true,
            showSizeChanger: true,
            pageSizeOptions: [3, 5, 10, 20],
            onChange: (page: number, pageSize: number) => {
                setCurrent(page);
                setPageSize(pageSize)
                console.log(hospitalSetList)
            }
        }}
    />
)
```

## 点击查询获取分页数据

```shell
描述： 做了什么，产生了什么结果？
	文本框输入内容，点击查询，重新获取分页数据!

拆分步骤（实现步骤）：
1. 获取文本框输入内容
   1. 参数：values
   2. form对象：
      1. const [form] = Form.useForm()
      2. 绑定form对象
      3. form.getFieldsValue获取
      4. Form.Item 要有name属性 hosname  hoscode
2. 给查询按钮绑定单击事件
   1. button   htmlType='submit'
   2. Form     onFinish ==> search 函数
3. 根据文本框内容发送ajax请求
   1. 在useEffect 的监听中 监听 hosname hoscode
   2. 在 onFinish的事件回调中，重新设置 hosname 和 hoscode的状态
```

src/pages/hospital/hospitalSet/hospitalSet.tsx

```tsx
 // 创建form对象
let [form] = Form.useForm();

// 搜索方法
const search = () => {
    // 获取form表单中的数据
    let { hosname, hoscode } = form.getFieldsValue();
    // 设置数据状态
    setHosname(hosname);
    setHoscode(hoscode);
    // 检索从第一页开始查看
    current !== 1 && setCurrent(1);
}

// 声明周期 
useEffect(() => {
    // 调用异步请求
    _getHospitalSetList();
}, [current, pageSize, hosname, hoscode])

<Form
    layout='inline'
    onFinish={search}
    form={form}
>
    <Form.Item name='hosname'>
        <Input placeholder='医院名称' />
    </Form.Item>
    <Form.Item name='hoscode'>
        <Input placeholder='医院编号' />
    </Form.Item>
    <Form.Item>
        <Space>
            <Button type='primary' htmlType='submit'>查询</Button>
            <Button>清空</Button>
        </Space>
    </Form.Item>
</Form>

```

### 清空搜索条件

src/pages/hospital/hospitalSet/hospitalSet.tsx

```tsx

// 清空方法
const clear = () => {
    // 1. 重置表单 hosname 和 hoscode ==>界面
    // 2. 重置 状态 hosname 和 hoscode  ===> 重发请求的
    form.resetFields();
    setHosname(undefined);
    setHoscode(undefined);
    setCurrent(1);
}

<Form.Item>
<Space>
    <Button type='primary' htmlType='submit'>查询</Button>
    <Button onClick={clear} disabled={hosname === undefined && hoscode === undefined}>清空</Button>
</Space>
</Form.Item>
```

## 添加医院功能实现

### 封装接口

```tsx
1. 请求方式、url、参数、响应结果
2. 封装 interface
3. 封装api函数
```

### 实现添加

```shell
描述：点击保存，将表单中的数据添加到医院列表
步骤：
 1. 绑定事件
    1. 给Form绑定 onFinish 事件
    2. Button组件 添加 htmlType='submit'
 2. 获取表单数据
    通过form获取
    0. Form.Item 组件需要有 name属性，并赋值
    1. 创建form： const [form] = Form.useForm()
    2. 给Form组件绑定form属性
    3. 通过form.getFieldsValue获取表单数据
 3. 发送ajax请求
    调用api函数，发送请求
```

src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
 {/* 这里的className:mt 是在 src/style/index.css引入的全局样式 */}
<Space className='mt'>
<Button type='primary' onClick={() => navigate('/syt/hospital/hospitalSet/add')}>添加</Button>
<Button disabled>批量删除</Button>
</Space>
```

src/pages/hospital/hospitalSet/components/AddOrUpdate.tex

```tsx
import { addHospitalSet } from '@/api/hospital/hospitalSet'
import { Button, Card, Form, Input, message, Space } from 'antd'
import React from 'react'
import {  useNavigate } from 'react-router-dom'

export default function AddOrUpdate() {
    // 定义form对象
    const [form] = Form.useForm()
    const navigate = useNavigate()
    const onFinish = async () => {
        let data = form.getFieldsValue()
        try{
            await addHospitalSet(data)
            message.success('添加成功')
            navigate('/syt/hospital/hospitalSet')
        }catch(e){
            message.error('添加失败')
        }
    }
    return (
        <Card>
            <Form
                name="basic"
                // 设置标签宽度
                labelCol={{ span: 2 }}
                // 设置输入框的宽度
                wrapperCol={{ span: 22 }}
                onFinish={onFinish}
                form={form}

            >
                <Form.Item
                    label="医院名称"
                    name="hosname"
                    rules={[{ required: true, message: '请输入医院名称!' }]}
                >
                    <Input />
                </Form.Item>

                <Form.Item
                    label="医院编号"
                    name="hoscode"
                    rules={[{ required: true, message: '请输入医院编号!' }]}
                >
                    <Input />
                </Form.Item>
                <Form.Item
                    label="api基础路径"
                    name="apiUrl"
                    rules={[{ required: true, message: '请输入api基础路径!' }]}
                >
                    <Input />
                </Form.Item>
                <Form.Item
                    label="联系人姓名"
                    name="contactsName"
                    rules={[{ required: true, message: '请输入联系人姓名!' }]}
                >
                    <Input />
                </Form.Item>
                <Form.Item
                    label="联系人手机"
                    name="contactsPhone"
                    rules={[{ required: true, message: '请输入联系人手机!' }]}
                >
                    <Input />
                </Form.Item>


                <Form.Item wrapperCol={{ offset: 2, span: 16 }}>
                    <Space>
                        <Button type="primary" htmlType="submit">
                            保存
                        </Button>
                        <Button>返回</Button>
                    </Space>
                </Form.Item>
            </Form>
        </Card>
    )
}


```

定义路由：src/routes/index.tex

```tsx
{
    // 路由路径
    path: "/syt/hospital",
    meta: {
        icon: <ShopOutlined />,
        title: '医院管理'
    },
    children: [
        {
            path: '/syt/hospital/hospitalSet',
            meta: {
                title: '医院设置'
            },
            element: load(HospitalSet)
        },
        {
            path: '/syt/hospital/hospitalSet/add',
            meta: {
                title: '添加医院'
            },
            hidden:true, // 隐藏菜单栏
            element: load(AddOrUpdate)
        }
    ]
}
```

定义请求体类型 src/api/model/hospitalSetType.ts

```ts
// 添加医院 请求体类型
export interface IHospitalSetData{
    apiUrl: string;
    contactsName: string;
    contactsPhone: string;
    hoscode: string;
    hosname: string;
}
```

封装接口 src/api/hospitalSet.ts

```ts
 * 添加医院设置
 * @param data 请求体数据
 * @returns null
 */
export const addHospitalSet = (data:IHospitalSetData)=>{
    return request.post<any,null>('/admin/hosp/hospitalSet/save', data)
}
```

## 删除医院功能

### 封装接口

封装接口 src/api/hospitalSet.ts

```ts
/**
 * 根据id 删除医院设置
 * @param id 
 * @returns null
 */
export const delHospitalSetById = (id:string)=>{
    return request.delete<any,null>(`/admin/hosp/hospitalSet/remove/${id}`)
}
```

在组件上绑定单机事件： src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
{
    title: '操作',
    width:120,
    fixed:'right',
    render(row: any) {
        return (
            <Space>
                <Button type='primary' icon={<EditOutlined />}>编辑</Button>
                <Button type='primary' icon={<DeleteOutlined />} onClick={() => { deleteHospitalById(row.id) }} danger>删除</Button>
            </Space>
        )
    }
}

// 删除医院方法
const deleteHospitalById = (id:string) => {

    // 弹窗
    confirm({
        title: '确定删除么?',
        icon: <ExclamationCircleFilled />,
        content: '删除当前记录',
        async onOk() {
            // 发送删除医院请求
            await delHospitalById(id)
            message.success('删除成功')
            // 刷新页面
            _getHospitalSetList()
        },
        onCancel() {
            console.log('Cancel');
        },
    });
}
```

## 批量删除功能

### 添加复选框

 src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
<Table
    className='mt'
    rowKey={'id'}
    columns={columns}
    dataSource={hospitalSetList}
    loading={loading}
    // 设置宽度
    scroll={{x:1300}}
    // 设置复选框
    rowSelection={{
        /**
         * onChange调用时机，列表复选框发生变化的时候
         * @param selectedKeys 选中条id组成的数组
         */
        onChange(selectedKeys: React.Key[]) {
            console.log('selectedKeys: ', selectedKeys)
            setSelectedKeys(selectedKeys);
        }
    }}
    pagination={{
        current,
        pageSize,
        total,
        showQuickJumper: true,
        showSizeChanger: true,
        pageSizeOptions: [3, 5, 10, 20],
        onChange: (page: number, pageSize: number) => {
            setCurrent(page);
            setPageSize(pageSize)
            console.log(hospitalSetList)
        }
    }}
/>
```

封装批量删除的api接口 src/api/hospitalSet.ts

```ts
// 批量删除,请求体的类型是React.Key[]不用再单独封装
/**
 * 
 * @param ids id 的数组
 * @returns null
 */
export const removeBatch = (ids: React.Key[]) => {
    return request.delete<any, null>('/admin/hosp/hospitalSet/batchRemove', {
        data: ids
    })
}
```

### 实现批量删除

src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
import { delHospitalById, getHospitalSetList, removeBatch } from '@/api/hospital/hospitalSet'

// 批量删除医院的方法
const batchRemove = (ids: React.Key[]) => {
    // 弹窗
    confirm({
        title: '确定删除么?',
        icon: <ExclamationCircleFilled />,
        content: '删除当前记录',
        async onOk() {
            // 发送删除医院请求
            await removeBatch(ids)
            // 将selectedKeys状态清空成空数组
            setSelectedKeys([]);
            message.success('删除成功')
            // 刷新页面
            _getHospitalSetList()
        },
        onCancel() {
            console.log('Cancel');
        },
    });
}



{/* 这里的className:mt 是在 src/style/index.css引入的全局样式 */}
<Space className='mt'>
<Button type='primary' onClick={() => navigate('/syt/hospital/hospitalSet/add')}>添加</Button>
<Button disabled={selectedKeys.length === 0} onClick={() => { batchRemove(selectedKeys) }}>批量删除</Button>
</Space>
```

## 编辑医院设置

定义路由：src/routes/index.tex

```ts
{
    path: '/syt/hospital/hospitalSet/edit/:id',
    meta: {
        title: '编辑医院'
    },
    hidden: true, // 隐藏菜单栏
    element: load(AddOrUpdate)
}
```

组件上绑定按钮：src/pages/hospital/hospitalSet/HospitalSet.tsx

```tsx
<Space>
<Button type='primary' icon={<EditOutlined />} onClick={() => { editHospitalById(row.id) }}>编辑</Button>
<Button type='primary' icon={<DeleteOutlined />} onClick={() => { deleteHospitalById(row.id) }} danger>删除</Button>
</Space>


```

封装api函数：src/api/hospitalSet.ts

```ts
/**
 * 根据id获取医院设置数据
 * @param id 
 * @returns Promise<IHospitalSetData>
 */
export const getHospitalSetById = (id:string)=>{
    return request.get<any,IHospitalSetData>('/admin/hosp/hospitalSet/get/' + id)
}

/**
 * 更新医院设置
 * @param data 
 * @returns null
 */
export const updateHospitalSet = (data:IHospitalSetUpdateData)=>{
    return request.put<any,null>('/admin/hosp/hospitalSet/update', data)
}

```

封装更新医院请求体类型：src/api/model/hospitalSetType.ts

```ts
/**
 * 更新医院设置请求体参数类型
 */
export interface IHospitalSetUpdateData extends IHospitalSetData{
    id:string;
}
```



## Base图片前缀

```ts

```



## 医院省市区列表

## 医院列表分页功能

## 排版功能

## 打包上线部署

## 总结