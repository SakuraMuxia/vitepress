# 项目练习

## 初始化项目

### 克隆项目

由于此项目是一个二次开发的项目，于是首先克隆项目代码

```shell
git clone https://gitee.com/yuonly0528/react-project.git
```

### 安装依赖

**修改镜像源(可选)**

```shell
# 腾讯
npm config set registry http://mirrors.cloud.tencent.com/npm
# 淘宝
npm config set registry https://registry.npmmirror.com
# npm 原镜像
npm config set registry https://registry.npmjs.org

# 查看npm配置
npm config list

# 设置npm代理
npm config set proxy http://<username>:<password>@<proxy-server-url>:<port>
npm config set proxy http://127.0.0.1:7890
npm config set https-proxy http://127.0.0.1:7890

# 删除npm代理
npm config delete proxy
npm config delete https-proxy
```

**安装依赖**

```shell
npm i -f  # -f force 强制安装
```

**启动项目**

```shell
npm start
```

**可能出现的问题**

```shell
1. 由于网络原因，导致包没下全。
   1. 删除node_modules : 切换源 重新 npm i -f安装
   2. 叉掉错误：对付用
2. token异常：
   1. 删除本地存储的token，刷新页面重新登录
```

## 项目接口地址

- 医院接口地址：http://139.198.34.216:8201/swagger-ui.html#/
- 数据字典接口地址：http://139.198.34.216:8202/swagger-ui.html#/259682545423383208563164929702
- 登录接口地址：http://139.198.34.216:8212/swagger-ui.html
- [医院管理接口文档](http://139.198.34.216:8201/swagger-ui.html)
- [用户登录接口文档](http://139.198.34.216:8230/doc.html)
- [数据字典接口文档](http://139.198.34.216:8202/swagger-ui.html)
- [用户管理接口文档](http://139.198.34.216:8203/swagger-ui.html)
- [订单管理接口文档](http://139.198.34.216:8206/swagger-ui.html)

### 测试接口

测试接口也叫对接口，联调接口。

我们可以使用 `swagger` `postman` 工具来测试接口。

测试接口目的：要保证接口是按照接口文档完成的，没有问题。这样未来我们开发时就不用考虑接口出错的原因了。

### 技术选型

- react@18 框架
- 全面使用hook函数组件
- react-router-dom@6 前端路由
- redux 集中状态管理方案
- axios 发送请求函数
- antd UI 库
- typescript
- nprogress 进度条
- create-react-app 脚手架
- craco 修改脚手架配置
- i18next & react-i18next i18n国际化
- echarts 数据可视化

### 项目开发流程

1. 项目立项（管理层）
2. 项目需求分析（市场部）

​			`产出`：项目需求文档( 产品经理 )

3. 设计产品原型 (关键)  (axure)

​			`产出`：项目原型图/草图(产品经理)

4. 产品开会

​			产品经理召集`前端、后端、UI、测试`开会。

*   对于前端来说：

    - 产品经理会给我们介绍项目需求具体情况，我们需要尽可能搞清楚需求，同时需要敲定需求完成时间。

    - UI 提供项目`UI原型图/标注图`。

    - 后端提供`接口文档`。

    - 认识对接后端、UI、测试、产品同事。

5. 前端开发

   - 根据后端提供开发的接口文档`测试接口`

   - 按照需求文档要求`开发项目功能`


6. 测试
7. 上线

### Demo演示

```shell
前台尚医通挂号平台(前台)在线访问地址: 
- http://syt-h5.atguigu.cn/
- http://syt.atguigu.cn/
```

## 项目配置

由于react项目为了限制私自更改webpack配置，所以react项目中没有webpack的配置文件`webpack.config.js`，于是为了修改webpack的配置文件，就需要用到 `craco`,通过craco配置，然后再引入到webpack配置中实现自定义webpack配置

配置`craro.config.js`

```js
const CracoLessPlugin = require("craco-less");
const CracoAlias = require("craco-alias");

module.exports = {
    plugins: [
        // 自定义主题
        {
            plugin: CracoLessPlugin,
            options: {
                lessLoaderOptions: {
                    lessOptions: {
                        modifyVars: { "@primary-color": "#1DA57A" },
                        javascriptEnabled: true,
                    },
                },
            },
        },
        // 路径别名
        {
            plugin: CracoAlias,
            options: {
                source: "tsconfig",
                baseUrl: "./",
                tsConfigPath: "./tsconfig.extend.json",
            },
        },
    ],
    // 开发服务器配置
    devServer: {
        // 激活代理服务器
        proxy: {
            // 将来以/dev-api开头的请求，就会被开发服务器转发到目标服务器去。
            "/dev-api": {
                // 需要转发的请求前缀
                target: "http://syt-api.atguigu.cn", // 目标服务器地址
                changeOrigin: true, // 允许跨域
                pathRewrite: {
                    // 路径重写
                    "^/dev-api": "",
                },
            },
        },
    },
};

```

配置`package.json`

```json
"scripts": {
    "start": "craco start",
    "build": "craco build",
    "test": "craco test",
    // 这里的eject作用就是把craco的配置引入到webpack中
    "eject": "react-scripts eject"
  },
```



### 路径别名

开发时当组件层级太深时，我们引入其他目录下文件需要回退很多层目录，很麻烦。

路径别名则提供另外一种写路径的方式，或者说路径简写，让我们可以从根路径出发直接写路径，简单方便。

配置文件：`tsconfig.extend.json`

```json
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"],
      "@api/*": ["src/api/*"],
      "@assets/*": ["src/assets/*"],
      "@comps/*": ["src/components/*"],
      "@utils/*": ["src/utils/*"],
      "@pages/*": ["src/pages/*"]
    }
  }
}
```

通过插件将上述配置加载到 `craco.config.js` , 最终会修改 `React` 脚手架配置，所以就可以项目中使用上述路径别名。

配置 `craco.config.js`

```js
// 路径别名
{
  plugin: CracoAlias,
  options: {
    source: "tsconfig",
    tsConfigPath: "./tsconfig.extend.json",
  },
},
```

### 路径提示

通过 extends 将上述配置加载到 `tsconfig.json` 中，此时在 `VSCode` 写代码才会有路径提示

配置`tsconfig.json`

```json
{
	"extends": "./tsconfig.extend.json",
}
```

我们将来如果要添加新的路径别名，只需要修改 `tsconfig.extend.json` 即可

### 设置代理服务器

- 代理服务器可以解决开发时的跨域问题。
- React脚手架本身提供的配置方式只支持单个代理
- 如果开发中需要有多个如何处理?   ==> 利用craco工具来配置

**代理服务器配置**

配置`craco.config.js`

```js
module.exports = {
	
  ...
  ...
  
	// 开发服务器配置
	devServer: {
		// 激活代理服务器
		proxy: {
			// 拦截以/dev-api开头的请求，就会被代理服务器拦截并转发到目标服务器去。
			"/dev-api": { // 需要转发的请求前缀
				target: "http://syt-api.atguigu.cn", // 目标服务器地址
				changeOrigin: true, // 为true时代理在转发时, 会将请求头的host改为target的值
				pathRewrite: { // 路径重写, 在转发请求时自动去除路径的/dev-api
					"^/dev-api": "",
				},
        	// 可以在下面配置多个代理
        	
			},
		},
	},
  
  
};
```

```js
需要注意的是，一旦生产环境打包项目，服务器以及相关配置并不会打包进去，所以如果运行打包后的项目，还会产生跨域问题。

最终还是需要服务端来解决，将来我们会学习 `nginx` 来解决此问题

项目中的baseUrl 需要和nginx中http根目录一致。
设置反向代理
```

### 环境变量设置

这里的环境变量是指node在运行时能够使用 `process.env`属性获取到的变量，这些变量定义在`.env.development`和`.env.production`中，具体使用哪一个文件中的变量，需要根据`webpack.config.js`中`Mode`属性的配置(dev or prod)

`.env.development`文件配置

```js
REACT_APP_MOCK_API = '/mock-api'
REACT_APP_API = '/dev-api'
```

`.env.production`文件配置

```js
REACT_APP_API = '/prod-api'
```



## 项目目录介绍

```shell
├── public # 公共静态资源目录
│   ├── favicon.ico # 网站图标
│   ├── index.html # 主页面
├── src # 主目录
│   ├── api # 接口文件
│   ├── app # redux配置文件
│   ├── components # 公共组件
│   │   ├── Loading # loading组件
│   │   ├── Translation # 国际化组件
│   │   └── withAuthorization # 登陆权限校验组件
│   ├── layouts # 主要布局组件
│   ├── locales # i18n国际化配置
│   ├── pages # 路由组件
│   ├── routes # 路由配置
│   ├── styles # 全局/公共样式
│   ├── utils # 工具函数
│   │   └── http # 封装请求函数
│   ├── App.tsx # App组件
│   ├── index.ts # 主入口
│   ├── react-app-env.d.ts # 类型文件，在编译时会引入额外文件
├── .env.development # 开发环境加载的环境变量配置
├── .env.production # 生产环境加载的环境变量配置
├── .gitignore # git忽略文件
├── craco.config.js # react脚手架配置文件
├── package.json # 包文件
├── README.md # 项目说明文件
├── tsconfig.extend.json # 路径别名配置文件
├── tsconfig.json # ts配置文件
└── yarn.lock # yarn下载包的缓存文件
```

## 实现功能步骤

```shell
1. 创建路由组件
2. 配置路由
3. 创建组件的静态结构
4. 查看接口
   1. 封装 interface 
   2. 封装 api 函数 
5. 调用 api 函数
   1. 事件回调
   2. 钩子函数  
6. 声明状态 
```

## 医院管理功能实现

### 创建路由组件

### 完成路由配置

### 静态资源布局

### 定义响应体类型

### 调用API

### 渲染数据

## 查询获取分页数据

## 添加医院功能实现

### 封装接口

```tsx
1. 请求方式、url、参数、响应结果
2. 封装 interface
3. 封装api函数
```

### 实现添加

```shell
描述：点击保存，将表单中的数据添加到医院列表
步骤：
 1. 绑定事件
    1. 给Form绑定 onFinish 事件
    2. Button组件 添加 htmlType='submit'
 2. 获取表单数据
    通过form获取
    0. Form.Item 组件需要有 name属性，并赋值
    1. 创建form： const [form] = Form.useForm()
    2. 给Form组件绑定form属性
    3. 通过form.getFieldsValue获取表单数据
 3. 发送ajax请求
    调用api函数，发送请求
```

## 删除医院功能

### 封装接口

### 实现删除

## 批量删除功能

## 编辑医院设置

## 医院省市区列表

## 医院列表分页功能

## 排版功能

## 打包上线部署

## 总结